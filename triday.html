<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <!-- v2.0 - Purple UI Update -->
    <title>TriDay Calendar - ÌïòÎ£®Î•º 3Î∞∞Î°ú ÌôúÏö©ÌïòÍ∏∞</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config-v2.js?nocache=20250827"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÖ</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f3f4f6;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                bottom: 0;
                z-index: 1000;
            }
            
            .sidebar.mobile-open {
                left: 0;
            }
            
            .mobile-menu-btn {
                display: block !important;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 999;
                background: white;
                border: none;
                padding: 10px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                cursor: pointer;
            }
        }
        
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }
        
        .time-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            height: 100%;
        }
        
        .time-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .morning-header {
            background: linear-gradient(135deg, #ffd93d 0%, #ffb347 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            margin: -20px -20px 16px -20px;
        }
        
        .lunch-header {
            background: linear-gradient(135deg, #ff9a3c 0%, #ff6b6b 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            margin: -20px -20px 16px -20px;
        }
        
        .evening-header {
            background: linear-gradient(135deg, #6b5b95 0%, #8e44ad 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            margin: -20px -20px 16px -20px;
        }
        
        .task-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin: 6px 0;
            cursor: move;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .task-item:hover {
            background: #f1f3f5;
            border-color: #e9ecef;
        }
        
        .task-item.completed {
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        .calendar-widget {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 12px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .calendar-day.selected {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.today {
            border: 2px solid rgba(255, 255, 255, 0.5);
            font-weight: bold;
        }
        
        .calendar-day.has-tasks {
            position: relative;
        }
        
        .calendar-day.has-tasks::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background: #ff6b6b;
            border-radius: 50%;
        }
        
        .routine-chip {
            display: inline-block;
            padding: 4px 10px;
            margin: 2px;
            background: #f0f0f0;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .routine-chip:hover {
            background: #667eea;
            color: white;
        }
        
        .progress-bar {
            height: 24px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .nav-button {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin: 4px 0;
        }
        
        .nav-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-button.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
        }
        
        .mobile-menu-btn {
            display: none;
        }
        
        @keyframes firework {
            0% { transform: translate(0, 0) scale(0); opacity: 1; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; }
        }
        
        .firework {
            position: fixed;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: firework 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // TriDay Calendar Component
        function TriDayCalendar() {
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [tasksData, setTasksData] = useState({}); // ÎÇ†ÏßúÎ≥Ñ ÌÉúÏä§ÌÅ¨ Ï†ÄÏû•
            const [routines, setRoutines] = useState([
                { id: 1, name: 'Ïö¥Îèô', time: 'morning', icon: 'üèÉ', isActive: true },
                { id: 2, name: 'Î™ÖÏÉÅ', time: 'morning', icon: 'üßò', isActive: true },
                { id: 3, name: 'ÎèÖÏÑú', time: 'evening', icon: 'üìö', isActive: true },
                { id: 4, name: 'ÏùºÍ∏∞', time: 'evening', icon: '‚úçÔ∏è', isActive: true }
            ]);
            const [newRoutineName, setNewRoutineName] = useState('');
            const [newRoutineTime, setNewRoutineTime] = useState('morning');
            const [newRoutineIcon, setNewRoutineIcon] = useState('üìå');
            const [showTimeSettings, setShowTimeSettings] = useState(false);
            const [goals, setGoals] = useState({
                yearly: { text: '', startDate: null, endDate: null, tasks: [] },
                monthly: { text: '', startDate: null, endDate: null, tasks: [] },
                weekly: { text: '', startDate: null, endDate: null, tasks: [] }
            });
            const [expandedGoal, setExpandedGoal] = useState(null);
            const [newGoalTask, setNewGoalTask] = useState('');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [timeRanges, setTimeRanges] = useState({
                morning: { start: '06:00', end: '12:00' },
                lunch: { start: '12:00', end: '18:00' },
                evening: { start: '18:00', end: '24:00' }
            });
            const [showRoutineManager, setShowRoutineManager] = useState(false);
            const [newTask, setNewTask] = useState('');
            const [selectedSection, setSelectedSection] = useState('morning');
            const [user, setUser] = useState(null);
            
            // ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÏùò ÌÇ§ ÏÉùÏÑ±
            const getDateKey = (date) => {
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                console.log('Date key generated:', key);
                return key;
            };
            
            // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÏùò ÌÉúÏä§ÌÅ¨ Í∞ÄÏ†∏Ïò§Í∏∞
            const getCurrentTasks = () => {
                const dateKey = getDateKey(selectedDate);
                return tasksData[dateKey] || { morning: [], lunch: [], evening: [] };
            };
            
            // ÌÉúÏä§ÌÅ¨ ÏóÖÎç∞Ïù¥Ìä∏
            const updateTasksForDate = (newTasks) => {
                const dateKey = getDateKey(selectedDate);
                console.log('Updating tasks for date:', dateKey, newTasks);
                setTasksData(prev => {
                    const updated = {
                        ...prev,
                        [dateKey]: newTasks
                    };
                    console.log('Updated tasksData:', updated);
                    return updated;
                });
                saveToLocal();
            };
            
            // ÌòÑÏû¨ ÏãúÍ∞ÑÎåÄ ÌôïÏù∏
            const getCurrentSection = () => {
                const hour = new Date().getHours();
                if (hour < 12) return 'morning';
                if (hour < 18) return 'lunch';
                return 'evening';
            };
            
            const [currentSection, setCurrentSection] = useState(getCurrentSection());
            
            // ÌÉúÏä§ÌÅ¨ Ï∂îÍ∞Ä
            const addTask = (section, taskText) => {
                if (!taskText.trim()) return;
                
                const currentTasks = getCurrentTasks();
                const newTaskItem = {
                    id: Date.now(),
                    text: taskText,
                    completed: false,
                    time: new Date().toLocaleTimeString(),
                    section: section
                };
                
                updateTasksForDate({
                    ...currentTasks,
                    [section]: [...currentTasks[section], newTaskItem]
                });
                
                setNewTask('');
            };
            
            // ÌÉúÏä§ÌÅ¨ ÏôÑÎ£å ÌÜ†Í∏Ä
            const toggleTask = (section, taskId) => {
                const currentTasks = getCurrentTasks();
                const updatedSection = currentTasks[section].map(task => 
                    task.id === taskId 
                        ? { ...task, completed: !task.completed }
                        : task
                );
                
                // ÏôÑÎ£åÏãú Ìè≠Ï£Ω Ìö®Í≥º
                const task = currentTasks[section].find(t => t.id === taskId);
                if (task && !task.completed) {
                    createFireworks();
                }
                
                updateTasksForDate({
                    ...currentTasks,
                    [section]: updatedSection
                });
            };
            
            // ÌÉúÏä§ÌÅ¨ ÏÇ≠Ï†ú
            const deleteTask = (section, taskId) => {
                const currentTasks = getCurrentTasks();
                updateTasksForDate({
                    ...currentTasks,
                    [section]: currentTasks[section].filter(task => task.id !== taskId)
                });
            };
            
            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
            const handleDragStart = (e, task, fromSection) => {
                e.dataTransfer.setData('task', JSON.stringify(task));
                e.dataTransfer.setData('fromSection', fromSection);
            };
            
            const handleDrop = (e, toSection) => {
                e.preventDefault();
                const task = JSON.parse(e.dataTransfer.getData('task'));
                const fromSection = e.dataTransfer.getData('fromSection');
                
                if (fromSection !== toSection) {
                    const currentTasks = getCurrentTasks();
                    updateTasksForDate({
                        ...currentTasks,
                        [fromSection]: currentTasks[fromSection].filter(t => t.id !== task.id),
                        [toSection]: [...currentTasks[toSection], { ...task, section: toSection }]
                    });
                }
            };
            
            const handleDragOver = (e) => {
                e.preventDefault();
            };
            
            // Î£®Ìã¥ Î∂àÎü¨Ïò§Í∏∞
            const loadRoutines = (section) => {
                const currentTasks = getCurrentTasks();
                const sectionRoutines = routines.filter(r => r.time === section);
                const newTasks = sectionRoutines.map(routine => ({
                    id: Date.now() + Math.random(),
                    text: routine.name,
                    completed: false,
                    time: new Date().toLocaleTimeString(),
                    section: section,
                    icon: routine.icon
                }));
                
                updateTasksForDate({
                    ...currentTasks,
                    [section]: [...currentTasks[section], ...newTasks]
                });
            };
            
            // ÏßÑÌñâÎ•† Í≥ÑÏÇ∞
            const getProgress = () => {
                const currentTasks = getCurrentTasks();
                const allTasks = [
                    ...currentTasks.morning,
                    ...currentTasks.lunch,
                    ...currentTasks.evening
                ];
                
                if (allTasks.length === 0) return 0;
                
                const completedTasks = allTasks.filter(t => t.completed).length;
                return Math.round((completedTasks / allTasks.length) * 100);
            };
            
            // Ìè≠Ï£Ω Ìö®Í≥º
            const createFireworks = () => {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd93d', '#6bcf7f', '#a78bfa'];
                const container = document.createElement('div');
                container.style.position = 'fixed';
                container.style.top = '0';
                container.style.left = '0';
                container.style.width = '100%';
                container.style.height = '100%';
                container.style.pointerEvents = 'none';
                container.style.zIndex = '9999';
                document.body.appendChild(container);
                
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                for (let i = 0; i < 30; i++) {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = centerX + 'px';
                    firework.style.top = centerY + 'px';
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.setProperty('--x', (Math.random() - 0.5) * 400 + 'px');
                    firework.style.setProperty('--y', (Math.random() - 0.5) * 400 + 'px');
                    container.appendChild(firework);
                }
                
                setTimeout(() => container.remove(), 1500);
            };
            
            // Îã¨Î†• Í¥ÄÎ†® Ìï®ÏàòÎì§
            const getDaysInMonth = (date) => {
                return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            };
            
            const getFirstDayOfMonth = (date) => {
                return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            };
            
            const isToday = (date) => {
                const today = new Date();
                return date.getDate() === today.getDate() &&
                       date.getMonth() === today.getMonth() &&
                       date.getFullYear() === today.getFullYear();
            };
            
            const isSameDay = (date1, date2) => {
                return date1.getDate() === date2.getDate() &&
                       date1.getMonth() === date2.getMonth() &&
                       date1.getFullYear() === date2.getFullYear();
            };
            
            const hasTasksForDate = (date) => {
                const dateKey = getDateKey(date);
                const tasks = tasksData[dateKey];
                if (!tasks) return false;
                return tasks.morning.length > 0 || tasks.lunch.length > 0 || tasks.evening.length > 0;
            };
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû•/Î°úÎìú
            const saveToLocal = () => {
                const data = {
                    tasksData,
                    goals,
                    routines,
                    timeRanges
                };
                console.log('Saving to localStorage:', data);
                localStorage.setItem('tridayData', JSON.stringify(data));
            };
            
            const loadFromLocal = () => {
                const saved = localStorage.getItem('tridayData');
                if (saved) {
                    const data = JSON.parse(saved);
                    setTasksData(data.tasksData || {});
                    // Handle old goals format
                    if (data.goals) {
                        if (typeof data.goals.yearly === 'string') {
                            setGoals({
                                yearly: { text: data.goals.yearly, startDate: null, endDate: null },
                                monthly: { text: data.goals.monthly || '', startDate: null, endDate: null },
                                weekly: { text: data.goals.weekly || '', startDate: null, endDate: null }
                            });
                        } else {
                            setGoals(data.goals);
                        }
                    }
                    setRoutines(data.routines || routines);
                    setTimeRanges(data.timeRanges || timeRanges);
                }
            };
            
            useEffect(() => {
                loadFromLocal();
                
                // ÏãúÍ∞ÑÎåÄ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏
                const interval = setInterval(() => {
                    setCurrentSection(getCurrentSection());
                }, 60000); // 1Î∂ÑÎßàÎã§ Ï≤¥ÌÅ¨
                
                // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                if (window.userManager && window.userManager.user) {
                    setUser(window.userManager.user);
                }
                
                return () => clearInterval(interval);
            }, []);
            
            useEffect(() => {
                saveToLocal();
            }, [tasksData, goals, routines, timeRanges]);
            
            const currentTasks = getCurrentTasks();
            const progress = getProgress();
            
            return (
                <div className="app-container">
                    {/* Mobile Menu Button */}
                    <button 
                        className="mobile-menu-btn"
                        onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                    >
                        <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2">
                            <path d="M3 12h18M3 6h18M3 18h18" />
                        </svg>
                    </button>
                    
                    {/* Sidebar */}
                    <div className={`sidebar ${mobileMenuOpen ? 'mobile-open' : ''}`}>
                        <div className="p-6">
                            {/* Logo */}
                            <div className="flex items-center justify-between mb-8">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-xl bg-white/20 backdrop-blur flex items-center justify-center">
                                        <span className="text-2xl">üìÖ</span>
                                    </div>
                                    <div>
                                        <h1 className="text-lg font-bold text-white">TriDay Calendar</h1>
                                        <p className="text-xs text-white/70">ÌïòÎ£®Î•º 3Î∞∞Î°ú</p>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setMobileMenuOpen(false)}
                                    className="lg:hidden text-white/70 hover:text-white"
                                >
                                    ‚úï
                                </button>
                            </div>
                        
                            {/* Progress */}
                            <div className="mb-6 bg-white/10 backdrop-blur rounded-xl p-4">
                                <div className="text-sm text-white/90 mb-3">
                                    <strong>{selectedDate.toLocaleDateString('ko-KR')}</strong>
                                </div>
                                <div className="h-2 bg-white/20 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full bg-gradient-to-r from-green-400 to-blue-400 transition-all duration-500"
                                        style={{ width: `${progress}%` }}
                                    />
                                </div>
                                <div className="flex justify-between items-center mt-2">
                                    <span className="text-xs text-white/70">
                                        {currentTasks.morning.length + currentTasks.lunch.length + currentTasks.evening.length}Í∞ú ÏûëÏóÖ
                                    </span>
                                    <span className="text-xs text-white font-bold">
                                        {progress}%
                                    </span>
                                </div>
                            </div>
                        
                            {/* Calendar */}
                            <div className="bg-white/10 backdrop-blur rounded-xl p-4 mb-6">
                                <div className="flex justify-between items-center mb-3">
                                    <button
                                        onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}
                                        className="p-1 text-white/70 hover:text-white rounded"
                                    >
                                        ‚óÄ
                                    </button>
                                    <div className="font-bold text-white">
                                        {currentMonth.getFullYear()}ÎÖÑ {currentMonth.getMonth() + 1}Ïõî
                                    </div>
                                    <button
                                        onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))}
                                        className="p-1 text-white/70 hover:text-white rounded"
                                    >
                                        ‚ñ∂
                                    </button>
                                </div>
                            
                            <div className="calendar-grid text-xs">
                                    {['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'].map(day => (
                                        <div key={day} className="text-center text-white/50 font-bold text-xs">
                                            {day}
                                        </div>
                                    ))}
                                
                                {Array.from({ length: getFirstDayOfMonth(currentMonth) }, (_, i) => (
                                    <div key={`empty-${i}`} />
                                ))}
                                
                                {Array.from({ length: getDaysInMonth(currentMonth) }, (_, i) => {
                                    const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), i + 1);
                                    return (
                                        <div
                                            key={i + 1}
                                            onClick={() => {
                                                console.log('Date selected:', date);
                                                setSelectedDate(date);
                                            }}
                                            className={`calendar-day ${isSameDay(date, selectedDate) ? 'selected' : ''} 
                                                      ${isToday(date) ? 'today' : ''} 
                                                      ${hasTasksForDate(date) ? 'has-tasks' : ''}`}
                                        >
                                            {i + 1}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        
                            {/* Navigation */}
                            <div className="space-y-2 mb-6">
                                <a href="index.html" className="nav-button">
                                    <span>‚úÖ</span> TodoMaster
                                </a>
                                <a href="triday.html" className="nav-button active">
                                    <span>üìÖ</span> TriDay Calendar
                                </a>
                                <a href="mindmap.html" className="nav-button">
                                    <span>üß†</span> ÎßàÏù∏ÎìúÎßµ
                                </a>
                                <a href="feedback.html" className="nav-button">
                                    <span>üí¨</span> ÌîºÎìúÎ∞± Í≤åÏãúÌåê
                                </a>
                            </div>
                        
                            {/* Routine Manager */}
                            <div className="bg-white/10 backdrop-blur rounded-xl p-4 mb-6">
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="font-bold text-sm text-white">üîÑ Î£®Ìã¥ Í¥ÄÎ¶¨</h3>
                                    <button
                                        onClick={() => setShowRoutineManager(!showRoutineManager)}
                                        className="text-xs text-blue-500 hover:text-blue-700 font-medium"
                                    >
                                        {showRoutineManager ? 'ÏôÑÎ£å' : '+ Ï∂îÍ∞Ä'}
                                    </button>
                                </div>
                                
                                {!showRoutineManager ? (
                                    <div className="space-y-2">
                                        {['morning', 'lunch', 'evening'].map(time => {
                                            const timeRoutines = routines.filter(r => r.time === time && r.isActive);
                                            if (timeRoutines.length === 0) return null;
                                            return (
                                                <div key={time} className="">
                                                    <div className="text-xs text-gray-500 mb-1">
                                                        {time === 'morning' ? 'üåÖ ÏïÑÏπ®' : time === 'lunch' ? '‚òÄÔ∏è Ï†êÏã¨' : 'üåô Ï†ÄÎÖÅ'}
                                                    </div>
                                                    <div className="flex flex-wrap gap-1">
                                                        {timeRoutines.map(routine => (
                                                            <button
                                                                key={routine.id}
                                                                onClick={() => {
                                                                    const section = routine.time;
                                                                    const currentTasks = getCurrentTasks();
                                                                    const newTask = {
                                                                        id: Date.now(),
                                                                        text: routine.name,
                                                                        completed: false,
                                                                        time: new Date().toLocaleTimeString(),
                                                                        section: section,
                                                                        icon: routine.icon
                                                                    };
                                                                    updateTasksForDate({
                                                                        ...currentTasks,
                                                                        [section]: [...currentTasks[section], newTask]
                                                                    });
                                                                    // Visual feedback
                                                                    const btn = event.target;
                                                                    btn.style.background = 'rgba(34, 197, 94, 0.2)';
                                                                    setTimeout(() => {
                                                                        btn.style.background = '';
                                                                    }, 300);
                                                                }}
                                                                className="routine-chip hover:bg-blue-100 hover:text-blue-700"
                                                            >
                                                                {routine.icon} {routine.name}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {/* Add new routine */}
                                        <div className="border rounded-lg p-3 bg-gray-50">
                                            <input
                                                type="text"
                                                placeholder="Î£®Ìã¥ Ïù¥Î¶Ñ"
                                                value={newRoutineName}
                                                onChange={(e) => setNewRoutineName(e.target.value)}
                                                className="w-full px-2 py-1 text-sm border rounded mb-2"
                                            />
                                            <div className="flex gap-2 mb-2">
                                                <select
                                                    value={newRoutineTime}
                                                    onChange={(e) => setNewRoutineTime(e.target.value)}
                                                    className="flex-1 px-2 py-1 text-sm border rounded"
                                                >
                                                    <option value="morning">üåÖ ÏïÑÏπ®</option>
                                                    <option value="lunch">‚òÄÔ∏è Ï†êÏã¨</option>
                                                    <option value="evening">üåô Ï†ÄÎÖÅ</option>
                                                </select>
                                                <input
                                                    type="text"
                                                    placeholder="ÏïÑÏù¥ÏΩò"
                                                    value={newRoutineIcon}
                                                    onChange={(e) => setNewRoutineIcon(e.target.value)}
                                                    className="w-12 px-2 py-1 text-sm border rounded text-center"
                                                />
                                            </div>
                                            <button
                                                onClick={() => {
                                                    if (newRoutineName.trim()) {
                                                        setRoutines(prev => [...prev, {
                                                            id: Date.now(),
                                                            name: newRoutineName,
                                                            time: newRoutineTime,
                                                            icon: newRoutineIcon,
                                                            isActive: true
                                                        }]);
                                                        setNewRoutineName('');
                                                        setNewRoutineIcon('üìå');
                                                    }
                                                }}
                                                className="w-full px-2 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600"
                                            >
                                                Ï∂îÍ∞ÄÌïòÍ∏∞
                                            </button>
                                        </div>
                                        
                                        {/* Existing routines */}
                                        <div className="space-y-2 max-h-48 overflow-y-auto">
                                            {routines.map(routine => (
                                                <div key={routine.id} className="flex items-center justify-between text-sm p-2 bg-white rounded border">
                                                    <div className="flex items-center gap-2">
                                                        <input
                                                            type="checkbox"
                                                            checked={routine.isActive}
                                                            onChange={() => {
                                                                setRoutines(prev => prev.map(r => 
                                                                    r.id === routine.id ? { ...r, isActive: !r.isActive } : r
                                                                ));
                                                            }}
                                                            className="w-3 h-3"
                                                        />
                                                        <span className={routine.isActive ? '' : 'opacity-50 line-through'}>
                                                            {routine.icon} {routine.name}
                                                        </span>
                                                        <span className="text-xs text-gray-500">
                                                            ({routine.time === 'morning' ? 'ÏïÑÏπ®' : routine.time === 'lunch' ? 'Ï†êÏã¨' : 'Ï†ÄÎÖÅ'})
                                                        </span>
                                                    </div>
                                                    <button
                                                        onClick={() => setRoutines(prev => prev.filter(r => r.id !== routine.id))}
                                                        className="text-red-500 hover:text-red-700 text-xs"
                                                    >
                                                        ÏÇ≠Ï†ú
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        
                            {/* Time Settings */}
                            <div className="mb-6">
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="font-bold text-sm text-gray-700">‚è∞ ÏãúÍ∞Ñ ÏÑ§Ï†ï</h3>
                                    <button
                                        onClick={() => setShowTimeSettings(!showTimeSettings)}
                                        className="text-xs text-gray-500 hover:text-gray-700"
                                    >
                                        {showTimeSettings ? 'Îã´Í∏∞' : 'ÏàòÏ†ï'}
                                    </button>
                                </div>
                                
                                {showTimeSettings && (
                                    <div className="space-y-2 text-xs">
                                        {['morning', 'lunch', 'evening'].map(period => (
                                            <div key={period} className="flex items-center justify-between">
                                                <span className="text-gray-600">
                                                    {period === 'morning' ? 'ÏïÑÏπ®' : period === 'lunch' ? 'Ï†êÏã¨' : 'Ï†ÄÎÖÅ'}
                                                </span>
                                                <div className="flex gap-1">
                                                    <input
                                                        type="time"
                                                        value={timeRanges[period].start}
                                                        onChange={(e) => setTimeRanges(prev => ({
                                                            ...prev,
                                                            [period]: { ...prev[period], start: e.target.value }
                                                        }))}
                                                        className="px-1 py-0.5 border rounded text-xs"
                                                    />
                                                    <span>-</span>
                                                    <input
                                                        type="time"
                                                        value={timeRanges[period].end}
                                                        onChange={(e) => setTimeRanges(prev => ({
                                                            ...prev,
                                                            [period]: { ...prev[period], end: e.target.value }
                                                        }))}
                                                        className="px-1 py-0.5 border rounded text-xs"
                                                    />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            
                            {/* User Info */}
                            {user && (
                                <div className="mt-auto pt-4 border-t border-gray-200">
                                    <div className="text-xs text-gray-500">
                                        {user.email}
                                    </div>
                                    <button
                                        onClick={async () => {
                                            await window.userManager.signOut();
                                            window.location.reload();
                                        }}
                                        className="text-xs text-red-500 hover:text-red-700 mt-2"
                                    >
                                        Î°úÍ∑∏ÏïÑÏõÉ
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* Main Content */}
                    <div className="main-content">
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold text-gray-800">
                                {selectedDate.toLocaleDateString('ko-KR', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric',
                                    weekday: 'long'
                                })}
                            </h2>
                            <p className="text-sm text-gray-600 mt-1">
                                ÌòÑÏû¨ ÏãúÍ∞ÑÎåÄ: <span className="font-bold text-purple-600">
                                    {currentSection === 'morning' ? 'üåÖ ÏïÑÏπ®' : 
                                     currentSection === 'lunch' ? '‚òÄÔ∏è Ï†êÏã¨' : 'üåô Ï†ÄÎÖÅ'}
                                </span>
                            </p>
                        </div>
                        
                        {/* Time Sections */}
                        <div className="grid lg:grid-cols-3 md:grid-cols-1 gap-6 mb-6">
                            {/* Morning Section */}
                            <div 
                                className="time-section"
                                onDrop={(e) => handleDrop(e, 'morning')}
                                onDragOver={handleDragOver}
                            >
                                <div className="morning-header">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold">
                                            üåÖ ÏïÑÏπ®
                                        </h3>
                                        <div className="flex items-center gap-2">
                                            <span className="text-xs opacity-90">
                                                {timeRanges.morning.start} - {timeRanges.morning.end}
                                            </span>
                                            <button
                                                onClick={() => loadRoutines('morning')}
                                                className="text-xs bg-white/20 px-2 py-1 rounded hover:bg-white/30"
                                            >
                                                +Î£®Ìã¥
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="space-y-2 mb-4 min-h-[150px]">
                                    {currentTasks.morning.map(task => (
                                        <div
                                            key={task.id}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, task, 'morning')}
                                            className={`task-item ${task.completed ? 'completed' : ''}`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={task.completed}
                                                        onChange={() => toggleTask('morning', task.id)}
                                                        className="w-4 h-4"
                                                    />
                                                    <span className="text-sm">
                                                        {task.icon} {task.text}
                                                    </span>
                                                </div>
                                                <button
                                                    onClick={() => deleteTask('morning', task.id)}
                                                    className="text-gray-400 hover:text-red-500 text-sm"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        placeholder="Ìï† Ïùº Ï∂îÍ∞Ä..."
                                        value={selectedSection === 'morning' ? newTask : ''}
                                        onChange={(e) => {
                                            setNewTask(e.target.value);
                                            setSelectedSection('morning');
                                        }}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter') {
                                                addTask('morning', newTask);
                                            }
                                        }}
                                        className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400"
                                    />
                                    <button
                                        onClick={() => addTask('morning', newTask)}
                                        className="px-3 py-2 text-sm bg-orange-500 text-white rounded-lg hover:bg-orange-600"
                                    >
                                        Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            </div>
                            
                            {/* Lunch Section */}
                            <div 
                                className="time-section"
                                onDrop={(e) => handleDrop(e, 'lunch')}
                                onDragOver={handleDragOver}
                            >
                                <div className="lunch-header">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold">
                                            ‚òÄÔ∏è Ï†êÏã¨
                                        </h3>
                                        <div className="flex items-center gap-2">
                                            <span className="text-xs opacity-90">
                                                {timeRanges.lunch.start} - {timeRanges.lunch.end}
                                            </span>
                                            <button
                                                onClick={() => loadRoutines('lunch')}
                                                className="text-xs bg-white/20 px-2 py-1 rounded hover:bg-white/30"
                                            >
                                                +Î£®Ìã¥
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="space-y-2 mb-4 min-h-[150px]">
                                    {currentTasks.lunch.map(task => (
                                        <div
                                            key={task.id}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, task, 'lunch')}
                                            className={`task-item ${task.completed ? 'completed' : ''}`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={task.completed}
                                                        onChange={() => toggleTask('lunch', task.id)}
                                                        className="w-4 h-4"
                                                    />
                                                    <span className="text-sm">
                                                        {task.icon} {task.text}
                                                    </span>
                                                </div>
                                                <button
                                                    onClick={() => deleteTask('lunch', task.id)}
                                                    className="text-gray-400 hover:text-red-500 text-sm"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        placeholder="Ìï† Ïùº Ï∂îÍ∞Ä..."
                                        value={selectedSection === 'lunch' ? newTask : ''}
                                        onChange={(e) => {
                                            setNewTask(e.target.value);
                                            setSelectedSection('lunch');
                                        }}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter') {
                                                addTask('lunch', newTask);
                                            }
                                        }}
                                        className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400"
                                    />
                                    <button
                                        onClick={() => addTask('lunch', newTask)}
                                        className="px-3 py-2 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600"
                                    >
                                        Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            </div>
                            
                            {/* Evening Section */}
                            <div 
                                className="time-section"
                                onDrop={(e) => handleDrop(e, 'evening')}
                                onDragOver={handleDragOver}
                            >
                                <div className="evening-header">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-bold">
                                            üåô Ï†ÄÎÖÅ
                                        </h3>
                                        <div className="flex items-center gap-2">
                                            <span className="text-xs opacity-90">
                                                {timeRanges.evening.start} - {timeRanges.evening.end}
                                            </span>
                                            <button
                                                onClick={() => loadRoutines('evening')}
                                                className="text-xs bg-white/20 px-2 py-1 rounded hover:bg-white/30"
                                            >
                                                +Î£®Ìã¥
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="space-y-2 mb-4 min-h-[150px]">
                                    {currentTasks.evening.map(task => (
                                        <div
                                            key={task.id}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, task, 'evening')}
                                            className={`task-item ${task.completed ? 'completed' : ''}`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={task.completed}
                                                        onChange={() => toggleTask('evening', task.id)}
                                                        className="w-4 h-4"
                                                    />
                                                    <span className="text-sm">
                                                        {task.icon} {task.text}
                                                    </span>
                                                </div>
                                                <button
                                                    onClick={() => deleteTask('evening', task.id)}
                                                    className="text-gray-400 hover:text-red-500 text-sm"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        placeholder="Ìï† Ïùº Ï∂îÍ∞Ä..."
                                        value={selectedSection === 'evening' ? newTask : ''}
                                        onChange={(e) => {
                                            setNewTask(e.target.value);
                                            setSelectedSection('evening');
                                        }}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter') {
                                                addTask('evening', newTask);
                                            }
                                        }}
                                        className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"
                                    />
                                    <button
                                        onClick={() => addTask('evening', newTask)}
                                        className="px-3 py-2 text-sm bg-purple-500 text-white rounded-lg hover:bg-purple-600"
                                    >
                                        Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        {/* Goals Section */}
                        <div className="space-y-6">
                            <h2 className="text-xl font-bold text-gray-800">üìä Î™©Ìëú Í¥ÄÎ¶¨</h2>
                            
                            {/* Yearly Goal */}
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="font-bold text-lg text-gray-700 flex items-center gap-2">
                                            <span className="text-2xl">üéØ</span> Ïó∞Í∞Ñ Î™©Ìëú
                                        </h3>
                                        <p className="text-sm text-gray-500 mt-1">
                                            {new Date().getFullYear()}ÎÖÑ 1Ïõî 1Ïùº - 12Ïõî 31Ïùº
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => setExpandedGoal(expandedGoal === 'yearly' ? null : 'yearly')}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        {expandedGoal === 'yearly' ? '‚ñ≤' : '‚ñº'}
                                    </button>
                                </div>
                                <textarea
                                    value={goals.yearly.text}
                                    onChange={(e) => setGoals(prev => ({ 
                                        ...prev, 
                                        yearly: { ...prev.yearly, text: e.target.value }
                                    }))}
                                    placeholder="Ïò¨Ìï¥ Ïù¥Î£®Í≥† Ïã∂ÏùÄ ÌÅ∞ Î™©ÌëúÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî..."
                                    className="w-full p-3 text-sm border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                                    rows={expandedGoal === 'yearly' ? "6" : "3"}
                                />
                                {expandedGoal === 'yearly' && (
                                    <div className="mt-3 p-3 bg-gray-50 rounded-lg">
                                        <p className="text-xs text-gray-600">üí° ÌåÅ: Íµ¨Ï≤¥Ï†ÅÏù¥Í≥† Ï∏°Ï†ï Í∞ÄÎä•Ìïú Î™©ÌëúÎ•º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</p>
                                    </div>
                                )}
                            </div>
                            
                            {/* Monthly Goal */}
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="font-bold text-lg text-gray-700 flex items-center gap-2">
                                            <span className="text-2xl">üìÖ</span> ÏõîÍ∞Ñ Î™©Ìëú
                                        </h3>
                                        <p className="text-sm text-gray-500 mt-1">
                                            {new Date().toLocaleDateString('ko-KR', { month: 'long' })} 1Ïùº - {new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate()}Ïùº
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => setExpandedGoal(expandedGoal === 'monthly' ? null : 'monthly')}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        {expandedGoal === 'monthly' ? '‚ñ≤' : '‚ñº'}
                                    </button>
                                </div>
                                <textarea
                                    value={goals.monthly.text}
                                    onChange={(e) => setGoals(prev => ({ 
                                        ...prev, 
                                        monthly: { ...prev.monthly, text: e.target.value }
                                    }))}
                                    placeholder="Ïù¥Î≤à Îã¨ ÏßëÏ§ëÌï† Î™©ÌëúÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî..."
                                    className="w-full p-3 text-sm border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                                    rows={expandedGoal === 'monthly' ? "6" : "3"}
                                />
                                {expandedGoal === 'monthly' && (
                                    <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                                        <p className="text-xs text-blue-600">üìà ÏßÑÌñâÎ•†: Ïù¥Î≤à Îã¨ {new Date().getDate()}ÏùºÏß∏</p>
                                    </div>
                                )}
                            </div>
                            
                            {/* Weekly Goal */}
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="font-bold text-lg text-gray-700 flex items-center gap-2">
                                            <span className="text-2xl">üìå</span> Ï£ºÍ∞Ñ Î™©Ìëú
                                        </h3>
                                        <p className="text-sm text-gray-500 mt-1">
                                            {(() => {
                                                const today = new Date();
                                                const monday = new Date(today);
                                                const day = monday.getDay();
                                                const diff = monday.getDate() - day + (day === 0 ? -6 : 1);
                                                monday.setDate(diff);
                                                const sunday = new Date(monday);
                                                sunday.setDate(monday.getDate() + 6);
                                                return `${monday.getMonth() + 1}Ïõî ${monday.getDate()}Ïùº (Ïõî) - ${sunday.getMonth() + 1}Ïõî ${sunday.getDate()}Ïùº (Ïùº)`;
                                            })()}
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => setExpandedGoal(expandedGoal === 'weekly' ? null : 'weekly')}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        {expandedGoal === 'weekly' ? '‚ñ≤' : '‚ñº'}
                                    </button>
                                </div>
                                <textarea
                                    value={goals.weekly.text}
                                    onChange={(e) => setGoals(prev => ({ 
                                        ...prev, 
                                        weekly: { ...prev.weekly, text: e.target.value }
                                    }))}
                                    placeholder="Ïù¥Î≤à Ï£º Îã¨ÏÑ±Ìï† Î™©ÌëúÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî..."
                                    className="w-full p-3 text-sm border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                                    rows={expandedGoal === 'weekly' ? "6" : "3"}
                                />
                                {expandedGoal === 'weekly' && (
                                    <div className="mt-3 p-3 bg-green-50 rounded-lg">
                                        <p className="text-xs text-green-600">
                                            üóìÔ∏è {['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][new Date().getDay()]}ÏöîÏùº - Ï£ºÏùò {new Date().getDay() === 0 ? 7 : new Date().getDay()}Î≤àÏß∏ ÎÇ†
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Î†åÎçîÎßÅ
        ReactDOM.render(<TriDayCalendar />, document.getElementById('root'));
    </script>
</body>
</html>