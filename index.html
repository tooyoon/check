<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>TodoMaster - ìŠ¤ë§ˆíŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="shared-design-system.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js?v=3.0"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ…</text></svg>">
    
    <script>
        // ëª¨ë°”ì¼ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ ë° ì²˜ë¦¬
        (function() {
            const ua = navigator.userAgent.toLowerCase();
            const isInAppBrowser = ua.includes('kakaotalk') || 
                                  ua.includes('naver') || 
                                  ua.includes('facebook') || 
                                  ua.includes('instagram') ||
                                  ua.includes('line') ||
                                  (ua.includes('mobile') && ua.includes('wv'));
            
            // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ì¸ì•± ë¸Œë¼ìš°ì € ì ‘ì† ì‹œ ëª¨ë°”ì¼ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
            if (isInAppBrowser && !localStorage.getItem('supabase.auth.token')) {
                // Hash fragmentì— access_tokenì´ ì—†ìœ¼ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸
                if (!window.location.hash.includes('access_token')) {
                    console.log('ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ - ëª¨ë°”ì¼ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                    // í˜„ì¬ í˜ì´ì§€ê°€ mobile-login.htmlì´ ì•„ë‹ ë•Œë§Œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    if (!window.location.pathname.includes('mobile-login.html')) {
                        window.location.href = '/mobile-login.html';
                    }
                }
            }
        })();
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }

        /* =============== Animations =============== */
        .task-complete {
            animation: completeWave 0.4s ease-out;
        }

        @keyframes completeWave {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); background-color: #dcfce7; }
            100% { transform: scale(1); }
        }
        
        /* Firework Animation */
        .firework-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: firework-explode 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        .firework-spark {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: spark-fade 1s ease-out forwards;
        }
        
        @keyframes firework-explode {
            0% {
                transform: translate(0, 0) scale(0);
                opacity: 1;
            }
            10% {
                transform: translate(0, 0) scale(1.5);
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        
        @keyframes spark-fade {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0.3);
                opacity: 0;
            }
        }
        
        .celebration-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 4rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            pointer-events: none;
            animation: celebration-pop 1s ease-out forwards;
        }
        
        @keyframes celebration-pop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-10deg);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }
        
        /* Search result highlight animation */
        .highlight-animation {
            animation: highlight 2s ease-in-out;
            position: relative;
        }
        
        @keyframes highlight {
            0%, 100% { background-color: transparent; }
            20%, 80% { background-color: rgba(59, 130, 246, 0.1); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); }
        }

        /* =============== Glass Effects =============== */
        .glassmorphism {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* =============== Card Hover Effects =============== */
        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            will-change: transform, box-shadow;
        }

        .card-hover:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* =============== Layout (Font-size responsive) =============== */
        .sidebar {
            width: clamp(280px, 20rem, 400px); /* ê¸€ê¼´ í¬ê¸°ì— ë”°ë¼ ìë™ ì¡°ì ˆ */
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            border-right: 1px solid rgba(226, 232, 240, 0.8);
            overflow-y: auto;
            overflow-x: visible;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: width 0.3s ease;
        }
        
        /* ê²€ìƒ‰ ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¸ì„ ë•Œ overflow í•´ì œ */
        .sidebar.search-open {
            overflow: visible;
        }

        .main-content {
            margin-left: clamp(280px, 20rem, 400px); /* ì‚¬ì´ë“œë°” ë„ˆë¹„ì™€ ë™ì¼ */
            min-height: 100vh;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transition: margin-left 0.3s ease;
        }

        /* =============== Category Styles =============== */
        .category-active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        /* =============== Progress Bar =============== */
        .progress-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        /* =============== Drag and Drop Styles =============== */
        .draggable {
            cursor: grab;
            user-select: none;
        }

        .draggable:active {
            cursor: grabbing;
        }

        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .drop-zone {
            position: relative;
        }

        .drop-indicator {
            position: absolute;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .drop-indicator.show {
            opacity: 1;
        }

        .drop-indicator.top {
            top: -6px;
        }

        .drop-indicator.bottom {
            bottom: -6px;
        }

        /* =============== Task Card Enhancements =============== */
        .task-card {
            position: relative;
            transition: all 0.2s ease;
        }

        .task-card.pinned {
            border-left: 4px solid #fbbf24;
        }

        .task-card .drag-handle {
            opacity: 0;
            transition: opacity 0.2s ease;
            cursor: grab;
            color: #9ca3af;
        }

        .task-card:hover .drag-handle {
            opacity: 1;
        }

        .task-card .drag-handle:active {
            cursor: grabbing;
        }

        .pin-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: 2px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            animation: pinPulse 2s ease-in-out infinite;
        }

        @keyframes pinPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* =============== Mobile Responsive =============== */
        .mobile-menu-button {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 20;
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border: none;
            border-radius: 0.75rem;
            color: white;
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
        }

        .mobile-menu-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 15;
        }

        @media (max-width: 768px) {
            .mobile-menu-button {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .sidebar { 
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: clamp(260px, 85vw, 320px); /* ëª¨ë°”ì¼ì—ì„œ í™”ë©´ í¬ê¸°ì— ë§ì¶¤ */
                z-index: 30;
            }
            
            .sidebar.mobile-open { 
                transform: translateX(0);
            }

            .mobile-overlay.show {
                display: block;
            }
            
            .main-content { 
                margin-left: 0;
                padding: 1rem;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì¹´ë“œ ê°„ê²© ì¶•ì†Œ */
            .space-y-4 > * + * {
                margin-top: 0.75rem;
            }

            /* ëª¨ë°”ì¼ì—ì„œ í—¤ë” ë²„íŠ¼ë“¤ ì„¸ë¡œ ë°°ì¹˜ */
            .mobile-header-buttons {
                flex-direction: column;
                gap: 0.5rem;
                width: 100%;
            }

            /* ëª¨ë°”ì¼ì—ì„œ í•„í„° ë°” ì„¸ë¡œ ë°°ì¹˜ */
            .mobile-filter-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì‘ì—… ì¹´ë“œ íŒ¨ë”© ì¶•ì†Œ */
            .task-card {
                padding: 1rem;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì„¤ì • ëª¨ë‹¬ í¬ê¸° ì¡°ì ˆ */
            .settings-modal {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
                overflow-y: auto;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 100vw; /* ì‘ì€ í™”ë©´ì—ì„œëŠ” ì „ì²´ ë„ˆë¹„ */
            }

            .main-content {
                padding: 0.75rem;
            }

            /* ë” ì‘ì€ í™”ë©´ì—ì„œ í°íŠ¸ í¬ê¸° ìë™ ì¡°ì ˆ */
            html {
                font-size: clamp(14px, 4vw, 16px);
            }
        }

        /* =============== Authentication Styles =============== */
        .auth-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .auth-modal {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        #sync-indicator {
            display: inline-flex !important;
            position: static !important;
        }
        
        .sync-indicator.syncing {
            background: #fef3c7 !important;
        }
        
        .sync-indicator.syncing .sync-dot {
            background: #fbbf24;
            animation: pulse 1.5s infinite;
        }
        
        .sync-indicator.syncing .sync-text {
            color: #92400e;
        }

        .sync-indicator.synced {
            background: #d1fae5 !important;
        }
        
        .sync-indicator.synced .sync-dot {
            background: #10b981;
        }
        
        .sync-indicator.synced .sync-text {
            color: #065f46;
        }

        .sync-indicator.offline {
            background: #fee2e2 !important;
        }
        
        .sync-indicator.offline .sync-dot {
            background: #ef4444;
        }
        
        .sync-indicator.offline .sync-text {
            color: #991b1b;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .user-profile-button {
            position: relative;
            cursor: pointer;
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 0.5rem;
            min-width: 200px;
            z-index: 50;
            display: none;
        }

        .user-dropdown.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* =============== Mobile Touch Optimization =============== */
        .task-card {
            touch-action: manipulation; /* ë”ë¸”íƒ­ ì¤Œ ë°©ì§€ */
            user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
        }

        .task-card h4 {
            user-select: text; /* ì œëª©ì€ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ */
        }

        /* ëª¨ë°”ì¼ì—ì„œ í˜¸ë²„ íš¨ê³¼ ê°œì„  */
        @media (hover: none) and (pointer: coarse) {
            .card-hover:hover {
                transform: none;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            
            .task-card:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
        }

        /* =============== Image Gallery Styles =============== */
        .image-gallery img {
            transition: all 0.2s ease;
        }

        .image-gallery img:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .image-modal {
            backdrop-filter: blur(8px);
        }

        .image-thumbnail {
            aspect-ratio: 1;
            object-fit: cover;
        }

        /* =============== Form Enhancements =============== */
        .form-input {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .form-input:focus {
            border-color: #3b82f6;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }

        /* =============== Loading and States =============== */
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* =============== Scrollbar Styling =============== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // =============== Constants ===============
        const PRIORITIES = [
            { value: "none", label: "ì—†ìŒ", color: "gray" },
            { value: "low", label: "ë‚®ìŒ", color: "blue" },
            { value: "medium", label: "ë³´í†µ", color: "yellow" },
            { value: "high", label: "ë†’ìŒ", color: "red" },
        ];

        // =============== Utility Functions ===============
        const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);
        const fmtDate = (iso) => (iso ? new Date(iso).toLocaleDateString('ko-KR') : "");

        // =============== ì´ë¯¸ì§€ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹° ===============
        function handleImagePaste(event, taskId, onImageAdded) {
            const items = event.clipboardData?.items;
            if (!items) return false;

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                if (item.type.indexOf('image') !== -1) {
                    const file = item.getAsFile();
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = async (e) => {
                            try {
                                const imageData = e.target.result;
                                const imageId = await db.saveImage(imageData, taskId);
                                onImageAdded && onImageAdded(imageId, imageData);
                            } catch (error) {
                                console.error('ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨:', error);
                                alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                        };
                        reader.readAsDataURL(file);
                        return true;
                    }
                }
            }
            return false;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // =============== ë§í¬ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹° ===============
        function linkifyText(text) {
            if (!text) return text;
            
            // URL ì •ê·œì‹ íŒ¨í„´ (http, https, ftp í¬í•¨)
            const urlRegex = /(https?:\/\/[^\s]+|www\.[^\s]+|ftp:\/\/[^\s]+)/gi;
            
            return text.replace(urlRegex, (url) => {
                let href = url;
                // wwwë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° http:// ì¶”ê°€
                if (url.startsWith('www.')) {
                    href = 'http://' + url;
                }
                return `<a href="${href}" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:text-blue-700 underline">${url}</a>`;
            });
        }

        function createLinkifiedElement(text, className = '') {
            const div = document.createElement('div');
            div.className = className;
            div.innerHTML = linkifyText(text);
            return div;
        }

        // =============== ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬ ===============
        function openImageGallery(images, startIndex = 0) {
            if (!images || images.length === 0) return;
            
            let currentIndex = startIndex;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 image-modal';
            modal.style.backdropFilter = 'blur(8px)';
            
            function updateModalContent() {
                const currentImage = images[currentIndex];
                modal.innerHTML = `
                    <div class="relative max-w-6xl max-h-6xl w-full h-full flex items-center justify-center p-4">
                        <!-- ë©”ì¸ ì´ë¯¸ì§€ -->
                        <img 
                            src="${currentImage.data}" 
                            alt="${currentImage.name}" 
                            class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
                            style="user-select: none;"
                        />
                        
                        <!-- ë‹«ê¸° ë²„íŠ¼ -->
                        <button 
                            class="absolute top-4 right-4 bg-white bg-opacity-90 text-black rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-100 transition-all shadow-lg font-bold text-lg"
                            onclick="closeModal()"
                        >
                            Ã—
                        </button>
                        
                        <!-- ì´ë¯¸ì§€ ì •ë³´ -->
                        <div class="absolute bottom-4 left-4 bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg">
                            <span class="text-sm">${currentIndex + 1} / ${images.length}</span>
                        </div>
                        
                        ${images.length > 1 ? `
                            <!-- ì´ì „ ë²„íŠ¼ -->
                            <button 
                                class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 text-black rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-100 transition-all shadow-lg font-bold text-xl ${currentIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                onclick="previousImage()"
                                ${currentIndex === 0 ? 'disabled' : ''}
                            >
                                â®
                            </button>
                            
                            <!-- ë‹¤ìŒ ë²„íŠ¼ -->
                            <button 
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 text-black rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-100 transition-all shadow-lg font-bold text-xl ${currentIndex === images.length - 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                                onclick="nextImage()"
                                ${currentIndex === images.length - 1 ? 'disabled' : ''}
                            >
                                â¯
                            </button>
                            
                            <!-- ì¸ë„¤ì¼ ë°” -->
                            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 bg-black bg-opacity-50 p-3 rounded-lg max-w-lg overflow-x-auto">
                                ${images.map((img, index) => `
                                    <img 
                                        src="${img.data}"
                                        class="w-12 h-12 object-cover rounded cursor-pointer border-2 transition-all ${index === currentIndex ? 'border-white scale-110' : 'border-transparent opacity-70 hover:opacity-100'}"
                                        onclick="goToImage(${index})"
                                    />
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // ì „ì—­ í•¨ìˆ˜ë“¤ì„ windowì— ì¶”ê°€
            window.closeModal = () => {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
                // ì „ì—­ í•¨ìˆ˜ë“¤ ì •ë¦¬
                delete window.closeModal;
                delete window.previousImage;
                delete window.nextImage;
                delete window.goToImage;
                delete window.handleKeyNavigation;
                document.removeEventListener('keydown', window.handleKeyNavigation);
            };
            
            window.previousImage = () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateModalContent();
                }
            };
            
            window.nextImage = () => {
                if (currentIndex < images.length - 1) {
                    currentIndex++;
                    updateModalContent();
                }
            };
            
            window.goToImage = (index) => {
                currentIndex = index;
                updateModalContent();
            };
            
            // í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜
            window.handleKeyNavigation = (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        window.previousImage();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        window.nextImage();
                        break;
                    case 'Escape':
                        e.preventDefault();
                        window.closeModal();
                        break;
                }
            };
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
            modal.onclick = (e) => {
                if (e.target === modal) {
                    window.closeModal();
                }
            };
            
            document.addEventListener('keydown', window.handleKeyNavigation);
            
            // ëª¨ë‹¬ í‘œì‹œ
            updateModalContent();
            document.body.appendChild(modal);
        }
        const fmtDateTime = (iso) => {
            if (!iso) return "";
            const date = new Date(iso);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            } else if (diffDays === 1) {
                return "ì–´ì œ";
            } else if (diffDays < 7) {
                return `${diffDays}ì¼ ì „`;
            } else {
                return date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            }
        };
        const todayISO = () => new Date().toISOString().slice(0, 10);

        function cn(...args) {
            return args.filter(Boolean).join(" ");
        }

        // =============== Sound Effects ===============
        function playTone(freq = 880, duration = 0.14, type = 'triangle', gain = 0.05) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const g = ctx.createGain();
                osc.type = type;
                osc.frequency.value = freq;
                osc.connect(g);
                g.connect(ctx.destination);
                const now = ctx.currentTime;
                g.gain.setValueAtTime(0.0001, now);
                g.gain.exponentialRampToValueAtTime(gain, now + 0.02);
                g.gain.exponentialRampToValueAtTime(0.0001, now + duration);
                osc.start(now);
                osc.stop(now + duration + 0.02);
                osc.onended = () => ctx.close && ctx.close();
            } catch (e) {
                console.log('Audio context not available');
            }
        }

        function playSuccess() {
            playTone(880, 0.12, 'triangle', 0.06);
            setTimeout(() => playTone(1320, 0.12, 'triangle', 0.05), 90);
            
            // Create confetti effect
            createConfetti();
        }
        
        function createConfetti() {
            // Create multiple firework bursts
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd93d', '#6bcf7f', '#a78bfa', '#f472b6', '#ff9f40'];
            
            // Create celebration text
            const celebText = document.createElement('div');
            celebText.className = 'celebration-text';
            celebText.textContent = 'ğŸ‰';
            document.body.appendChild(celebText);
            setTimeout(() => celebText.remove(), 1000);
            
            // Create 3-5 firework bursts at different positions
            const burstCount = Math.floor(Math.random() * 3) + 3;
            
            for (let b = 0; b < burstCount; b++) {
                setTimeout(() => {
                    const container = document.createElement('div');
                    container.className = 'firework-container';
                    document.body.appendChild(container);
                    
                    // Random position for each burst
                    const centerX = Math.random() * window.innerWidth;
                    const centerY = Math.random() * window.innerHeight * 0.6; // Upper 60% of screen
                    
                    // Create explosion effect
                    const particleCount = 30;
                    const burstColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    for (let i = 0; i < particleCount; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'firework';
                        
                        // Calculate explosion trajectory
                        const angle = (Math.PI * 2 * i) / particleCount;
                        const velocity = 100 + Math.random() * 200;
                        const finalX = Math.cos(angle) * velocity;
                        const finalY = Math.sin(angle) * velocity;
                        
                        particle.style.left = centerX + 'px';
                        particle.style.top = centerY + 'px';
                        particle.style.backgroundColor = burstColor;
                        particle.style.boxShadow = `0 0 6px ${burstColor}`;
                        
                        // Custom animation for each particle
                        particle.style.animation = 'none';
                        particle.animate([
                            { 
                                transform: 'translate(0, 0) scale(0)',
                                opacity: 1
                            },
                            {
                                transform: 'translate(0, 0) scale(2)',
                                opacity: 1,
                                offset: 0.1
                            },
                            { 
                                transform: `translate(${finalX}px, ${finalY}px) scale(0.5)`,
                                opacity: 0
                            }
                        ], {
                            duration: 1500,
                            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                        });
                        
                        container.appendChild(particle);
                        
                        // Add sparks
                        if (i % 3 === 0) {
                            const spark = document.createElement('div');
                            spark.className = 'firework-spark';
                            spark.style.left = centerX + 'px';
                            spark.style.top = centerY + 'px';
                            spark.style.backgroundColor = '#ffffff';
                            spark.style.boxShadow = '0 0 10px #ffffff';
                            container.appendChild(spark);
                        }
                    }
                    
                    // Remove container after animation
                    setTimeout(() => container.remove(), 2000);
                }, b * 200);
            }
        }

        function playUndo() {
            playTone(440, 0.12, 'sine', 0.05);
        }

        // =============== Local Storage Database ===============
        class LocalFileDB {
            constructor() {
                this.data = { categories: [], tasks: [] };
                this.loadData();
            }

            async loadData() {
                try {
                    const stored = localStorage.getItem('todoMasterApp');
                    if (stored) {
                        this.data = JSON.parse(stored);
                    }
                    
                    if (this.data.categories.length === 0) {
                        this.data.categories = [
                            { id: "work", name: "ì—…ë¬´", emoji: "ğŸ’¼", builtin: false },
                            { id: "home", name: "ê°€ì •", emoji: "ğŸ ", builtin: false },
                            { id: "personal", name: "ê°œì¸", emoji: "ğŸ‘¤", builtin: false },
                            { id: "study", name: "í•™ìŠµ", emoji: "ğŸ“š", builtin: false }
                        ];
                        await this.saveData();
                    }
                } catch (e) {
                    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', e);
                }
            }

            async saveData() {
                try {
                    localStorage.setItem('todoMasterApp', JSON.stringify(this.data));
                } catch (e) {
                    console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', e);
                }
            }

            async getCategories() {
                return [...this.data.categories];
            }

            async getTasks() {
                return [...this.data.tasks];
            }

            async saveCategory(category) {
                const index = this.data.categories.findIndex(c => c.id === category.id);
                if (index >= 0) {
                    this.data.categories[index] = category;
                } else {
                    this.data.categories.push(category);
                }
                await this.saveData();
                
                // Mark local category update time
                localStorage.setItem('lastLocalCategoryUpdate', new Date().getTime().toString());
                
                // Sync to Supabase if logged in
                if (window.userManager && window.userManager.isLoggedIn()) {
                    await window.userManager.saveCategories(this.data.categories);
                    window.syncManager.updateSyncStatus('synced');
                }
            }

            async deleteCategory(id) {
                this.data.categories = this.data.categories.filter(c => c.id !== id);
                this.data.tasks = this.data.tasks.filter(t => t.categoryId !== id);
                await this.saveData();
                
                // Sync to Supabase if logged in
                if (window.userManager && window.userManager.isLoggedIn()) {
                    await window.userManager.saveCategories(this.data.categories);
                    await window.userManager.saveTodos(this.data.tasks);
                    window.syncManager.updateSyncStatus('synced');
                }
            }

            async saveTask(task) {
                const index = this.data.tasks.findIndex(t => t.id === task.id);
                if (index >= 0) {
                    this.data.tasks[index] = task;
                } else {
                    this.data.tasks.push(task);
                }
                await this.saveData();
                
                // Mark local update time to prevent reload loop
                localStorage.setItem('lastLocalUpdate', new Date().getTime().toString());
                
                // Sync to Supabase immediately if logged in
                if (window.userManager && window.userManager.isLoggedIn()) {
                    // Force immediate save to cloud
                    try {
                        await window.userManager.saveCategories(this.data.categories);
                        await window.userManager.saveTodos(this.data.tasks);
                        window.syncManager.updateSyncStatus('synced');
                        console.log('Data saved to cloud immediately');
                    } catch (error) {
                        console.error('Failed to save to cloud:', error);
                    }
                }
            }

            async deleteTask(id) {
                // ì‘ì—…ê³¼ ì—°ê´€ëœ ì´ë¯¸ì§€ë“¤ë„ í•¨ê»˜ ì‚­ì œ
                if (this.data.images) {
                    this.data.images = this.data.images.filter(img => img.taskId !== id);
                }
                this.data.tasks = this.data.tasks.filter(t => t.id !== id);
                await this.saveData();
                
                // Sync to Supabase immediately if logged in
                if (window.userManager && window.userManager.isLoggedIn()) {
                    // Force immediate save to cloud
                    try {
                        await window.userManager.saveCategories(this.data.categories);
                        await window.userManager.saveTodos(this.data.tasks);
                        window.syncManager.updateSyncStatus('synced');
                        console.log('Data saved to cloud immediately');
                    } catch (error) {
                        console.error('Failed to save to cloud:', error);
                    }
                }
            }

            // =============== ì´ë¯¸ì§€ ê´€ë¦¬ ===============
            async saveImage(imageData, taskId) {
                if (!this.data.images) {
                    this.data.images = [];
                }
                const imageId = `img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const image = {
                    id: imageId,
                    taskId: taskId,
                    data: imageData, // base64 ë°ì´í„°
                    createdAt: new Date().toISOString(),
                    name: `image_${imageId}.png`
                };
                this.data.images.push(image);
                await this.saveData();
                return imageId;
            }

            async deleteImage(imageId) {
                if (!this.data.images) return;
                this.data.images = this.data.images.filter(img => img.id !== imageId);
                await this.saveData();
            }

            async getTaskImages(taskId) {
                if (!this.data.images) return [];
                return this.data.images.filter(img => img.taskId === taskId);
            }

            async exportData() {
                return JSON.stringify(this.data, null, 2);
            }

            async importData(jsonStr) {
                try {
                    const newData = JSON.parse(jsonStr);
                    this.data = newData;
                    await this.saveData();
                    return true;
                } catch (e) {
                    console.error('Import ì˜¤ë¥˜:', e);
                    return false;
                }
            }
        }

        const db = new LocalFileDB();

        // =============== Drag and Drop Utilities ===============
        let draggedTask = null;
        let draggedIndex = null;

        function handleDragStart(e, task, index) {
            draggedTask = task;
            draggedIndex = index;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.drop-indicator').forEach(indicator => {
                indicator.classList.remove('show');
            });
            draggedTask = null;
            draggedIndex = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            const dropZone = e.currentTarget;
            const rect = dropZone.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;
            
            const topIndicator = dropZone.querySelector('.drop-indicator.top');
            const bottomIndicator = dropZone.querySelector('.drop-indicator.bottom');
            
            if (e.clientY < midpoint) {
                topIndicator?.classList.add('show');
                bottomIndicator?.classList.remove('show');
            } else {
                topIndicator?.classList.remove('show');
                bottomIndicator?.classList.add('show');
            }
        }

        function handleDragLeave(e) {
            const dropZone = e.currentTarget;
            if (!dropZone.contains(e.relatedTarget)) {
                dropZone.querySelectorAll('.drop-indicator').forEach(indicator => {
                    indicator.classList.remove('show');
                });
            }
        }

        // =============== Linkified Text Component ===============
        const LinkifiedText = React.memo(function LinkifiedText({ text, className = '' }) {
            const ref = useRef(null);

            useEffect(() => {
                if (ref.current && text) {
                    ref.current.innerHTML = linkifyText(text);
                }
            }, [text]);

            if (!text) return null;

            return React.createElement('div', {
                ref: ref,
                className: className,
                dangerouslySetInnerHTML: { __html: linkifyText(text) }
            });
        });

        // =============== Task Image Indicator Component ===============
        const TaskImageIndicator = React.memo(function TaskImageIndicator({ taskId }) {
            const [imageCount, setImageCount] = useState(0);

            useEffect(() => {
                async function loadImageCount() {
                    try {
                        const taskImages = await db.getTaskImages(taskId);
                        setImageCount(taskImages.length);
                    } catch (error) {
                        console.error('ì´ë¯¸ì§€ ê°œìˆ˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                        setImageCount(0);
                    }
                }
                loadImageCount();
                
                // ì´ë¯¸ì§€ ë³€ê²½ì„ ê°ì§€í•˜ê¸° ìœ„í•œ ì£¼ê¸°ì  ì²´í¬
                const interval = setInterval(loadImageCount, 1000);
                return () => clearInterval(interval);
            }, [taskId]);

            if (imageCount === 0) return null;

            return (
                <div className="flex items-center gap-1 mt-2">
                    <span className="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-full flex items-center gap-1">
                        ğŸ“· {imageCount}ê°œ
                    </span>
                </div>
            );
        });

        // =============== Task Images Component ===============
        const TaskImages = React.memo(function TaskImages({ taskId }) {
            const [images, setImages] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                async function loadImages() {
                    try {
                        const taskImages = await db.getTaskImages(taskId);
                        setImages(taskImages);
                    } catch (error) {
                        console.error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                    } finally {
                        setLoading(false);
                    }
                }
                loadImages();
                
                // ì´ë¯¸ì§€ ë³€ê²½ì„ ê°ì§€í•˜ê¸° ìœ„í•œ ì£¼ê¸°ì  ì²´í¬
                const interval = setInterval(() => {
                    loadImages();
                }, 1000);
                return () => clearInterval(interval);
            }, [taskId]);

            async function deleteImage(imageId) {
                if (confirm('ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        await db.deleteImage(imageId);
                        setImages(prev => prev.filter(img => img.id !== imageId));
                    } catch (error) {
                        console.error('ì´ë¯¸ì§€ ì‚­ì œ ì‹¤íŒ¨:', error);
                        alert('ì´ë¯¸ì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            }

            if (loading) return null;
            if (images.length === 0) return null;

            return (
                <div className="mt-3">
                    <div className="flex items-center gap-2 mb-2">
                        <span className="text-xs text-gray-500">ğŸ“· ì²¨ë¶€ ì´ë¯¸ì§€</span>
                        <span className="text-xs bg-gray-100 px-2 py-1 rounded-full text-gray-600">
                            {images.length}ê°œ
                        </span>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                        {images.map((image) => (
                            <div key={image.id} className="relative group">
                                <img
                                    src={image.data}
                                    alt={image.name}
                                    className="w-full h-20 object-cover rounded-lg border border-gray-200 hover:shadow-md transition-all cursor-pointer"
                                    onClick={() => {
                                        openImageGallery(images, images.findIndex(img => img.id === image.id));
                                    }}
                                />
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        deleteImage(image.id);
                                    }}
                                    className="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600"
                                    title="ì´ë¯¸ì§€ ì‚­ì œ"
                                >
                                    Ã—
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        });

        // =============== Task Card Component ===============
        const TaskCard = React.memo(function TaskCard({ 
            task, 
            categories, 
            onUpdate, 
            onDelete, 
            onToggle, 
            onTogglePin, 
            onReorder,
            index,
            filteredTasks 
        }) {
            const [editing, setEditing] = useState(false);
            const [expanded, setExpanded] = useState(false);
            const [title, setTitle] = useState(task.title);
            const [memo, setMemo] = useState(task.memo || "");
            const [priority, setPriority] = useState(task.priority);
            const [due, setDue] = useState(task.due || "");
            const [categoryId, setCategoryId] = useState(task.categoryId);

            const handleSave = () => {
                onUpdate(task.id, {
                    title: title.trim() || "ë¬´ì œ",
                    memo: memo.trim(),
                    priority,
                    due,
                    categoryId,
                });
                setEditing(false);
            };

            const handleCancel = () => {
                setTitle(task.title);
                setMemo(task.memo || "");
                setPriority(task.priority);
                setDue(task.due || "");
                setCategoryId(task.categoryId);
                setEditing(false);
            };

            const priorityColor = PRIORITIES.find(p => p.value === task.priority)?.color || "gray";
            const isOverdue = task.due && new Date(task.due) < new Date() && !task.checked;

            const handleDoubleClick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                // ë°ìŠ¤í¬í†±ì—ì„œë§Œ ë”ë¸”í´ë¦­ìœ¼ë¡œ í¸ì§‘
                if (window.innerWidth > 768 && !editing) {
                    setEditing(true);
                }
            };

            const handleCardClick = (e) => {
                e.stopPropagation();
                // ì²´í¬ë°•ìŠ¤, ë²„íŠ¼ í´ë¦­ì€ ì œì™¸
                if (e.target.closest('input[type="checkbox"]') || 
                    e.target.closest('button') || 
                    e.target.closest('.task-actions')) {
                    return;
                }
                
                // í¸ì§‘ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ í¼ì¹˜ê¸°/ì ‘ê¸°
                if (!editing) {
                    setExpanded(prev => !prev);
                }
            };

            const handleEditClick = (e) => {
                e.stopPropagation();
                setEditing(true);
                setExpanded(true); // í¸ì§‘ ì‹œ ìë™ìœ¼ë¡œ í¼ì¹˜ê¸°
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const rect = e.currentTarget.getBoundingClientRect();
                const midpoint = rect.top + rect.height / 2;
                const dropPosition = e.clientY < midpoint ? 'before' : 'after';
                
                if (draggedTask && draggedTask.id !== task.id) {
                    onReorder(draggedTask, index, dropPosition);
                }
                
                e.currentTarget.querySelectorAll('.drop-indicator').forEach(indicator => {
                    indicator.classList.remove('show');
                });
            };

            if (editing) {
                return (
                    <div className="glassmorphism rounded-2xl p-6 transition-all duration-300 task-card fade-in">
                        <div className="space-y-4">
                            <input
                                value={title}
                                onChange={(e) => setTitle(e.target.value)}
                                onKeyDown={(e) => {
                                    if (e.key === "Enter" && !e.shiftKey) {
                                        e.preventDefault();
                                        handleSave();
                                    }
                                    if (e.key === "Escape") {
                                        handleCancel();
                                    }
                                }}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent form-input"
                                placeholder="ì‘ì—… ì œëª© (ì—”í„°: ì €ì¥, ESC: ì·¨ì†Œ)"
                                autoFocus
                            />
                            <textarea
                                value={memo}
                                onChange={(e) => setMemo(e.target.value)}
                                onPaste={(e) => {
                                    if (handleImagePaste(e, task.id, (imageId, imageData) => {
                                        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                                        const msg = document.createElement('div');
                                        msg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                                        msg.textContent = 'ğŸ“· ì´ë¯¸ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!';
                                        document.body.appendChild(msg);
                                        setTimeout(() => {
                                            if (document.body.contains(msg)) {
                                                document.body.removeChild(msg);
                                            }
                                        }, 2000);
                                        
                                        // ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤
                                    })) {
                                        e.preventDefault();
                                    }
                                }}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent form-input"
                                placeholder="ë©”ëª¨ (ì„ íƒì‚¬í•­) - ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥ ğŸ“·"
                                rows={3}
                            />
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <select
                                    value={priority}
                                    onChange={(e) => setPriority(e.target.value)}
                                    className="px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                                >
                                    {PRIORITIES.map(p => (
                                        <option key={p.value} value={p.value}>
                                            {p.value === 'high' ? 'ğŸ”´' : p.value === 'medium' ? 'ğŸŸ¡' : p.value === 'low' ? 'ğŸ”µ' : 'âšª'} {p.label}
                                        </option>
                                    ))}
                                </select>
                                <input
                                    type="date"
                                    value={due}
                                    onChange={(e) => setDue(e.target.value)}
                                    className="px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                                />
                                <select
                                    value={categoryId}
                                    onChange={(e) => setCategoryId(e.target.value)}
                                    className="px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                                >
                                    {categories.filter(c => c.id !== "all").map(c => (
                                        <option key={c.id} value={c.id}>{c.emoji} {c.name}</option>
                                    ))}
                                </select>
                            </div>
                            
                            {/* í¸ì§‘ ëª¨ë“œì—ì„œë§Œ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ í‘œì‹œ */}
                            <TaskImages taskId={task.id} />
                            
                            {/* ë©”ëª¨ ë¯¸ë¦¬ë³´ê¸° (ë§í¬ í¬í•¨) */}
                            {memo && (
                                <div className="p-3 bg-gray-50 rounded-lg">
                                    <h4 className="text-sm font-medium text-gray-700 mb-2">ğŸ“ ë©”ëª¨ ë¯¸ë¦¬ë³´ê¸°:</h4>
                                    <LinkifiedText 
                                        text={memo}
                                        className="text-sm text-gray-600 leading-relaxed"
                                    />
                                </div>
                            )}
                            
                            <div className="flex gap-3">
                                <button
                                    onClick={handleSave}
                                    className="px-6 py-3 rounded-xl text-white font-medium btn-primary"
                                >
                                    ğŸ’¾ ì €ì¥
                                </button>
                                <button
                                    onClick={handleCancel}
                                    className="px-6 py-3 rounded-xl font-medium btn-secondary"
                                >
                                    âŒ ì·¨ì†Œ
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div
                    className={cn(
                        "glassmorphism rounded-2xl p-6 transition-all duration-300 card-hover task-card drop-zone relative fade-in",
                        task.checked && "opacity-70 grayscale",
                        isOverdue && "ring-2 ring-red-300 bg-red-50/50",
                        task.pinned && "ring-2 ring-yellow-400 bg-yellow-50/30",
                        !task.checked && "hover:shadow-lg"
                    )}
                    data-task-id={task.id}
                    onClick={handleCardClick}
                    onDoubleClick={handleDoubleClick}
                    onDragOver={handleDragOver}
                    onDragLeave={handleDragLeave}
                    onDrop={handleDrop}
                    draggable={!editing}
                    onDragStart={(e) => handleDragStart(e, task, index)}
                    onDragEnd={handleDragEnd}
                >
                    <div className="drop-indicator top"></div>
                    <div className="drop-indicator bottom"></div>
                    
                    {task.pinned && (
                        <div className="pin-badge">
                            ğŸ“Œ
                        </div>
                    )}
                    
                    <div className="flex items-start gap-4">
                        <div className="drag-handle text-lg p-1 rounded hover:bg-gray-100" title="ë“œë˜ê·¸í•´ì„œ ìˆœì„œ ë³€ê²½">
                            â‹®â‹®
                        </div>
                        
                        <button
                            onClick={() => onToggle(task.id)}
                            className={cn(
                                "mt-1 w-7 h-7 rounded-xl border-2 flex items-center justify-center transition-all duration-300 font-bold",
                                task.checked
                                    ? "bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-500 text-white shadow-lg transform scale-110"
                                    : "border-gray-300 hover:border-blue-500 hover:bg-blue-50 hover:scale-105"
                            )}
                        >
                            {task.checked && "âœ“"}
                        </button>
                        
                        <div className="flex-1 min-w-0">
                            <div className="flex items-start gap-3 mb-2">
                                <div className="flex-1 min-w-0">
                                    <div className="flex items-center gap-3 mb-1">
                                        <div className="flex items-center gap-2 flex-1">
                                            <h4
                                                className={cn(
                                                    "font-semibold text-lg flex-1",
                                                    task.checked && "line-through text-gray-500"
                                                )}
                                            >
                                                {task.title}
                                            </h4>
                                            {(task.memo || task.images) && (
                                                <span className="text-gray-400 text-sm select-none">
                                                    {expanded ? 'â–¼' : 'â–¶'}
                                                </span>
                                            )}
                                        </div>
                                        {task.priority !== "none" && (
                                            <span
                                                className={cn(
                                                    "px-3 py-1 text-xs font-medium rounded-full flex-shrink-0",
                                                    priorityColor === "red" && "bg-gradient-to-r from-red-100 to-red-200 text-red-700 border border-red-300",
                                                    priorityColor === "yellow" && "bg-gradient-to-r from-yellow-100 to-yellow-200 text-yellow-700 border border-yellow-300",
                                                    priorityColor === "blue" && "bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 border border-blue-300"
                                                )}
                                            >
                                                {task.priority === 'high' ? 'ğŸ”´' : task.priority === 'medium' ? 'ğŸŸ¡' : task.priority === 'low' ? 'ğŸ”µ' : 'âšª'} {PRIORITIES.find(p => p.value === task.priority)?.label}
                                            </span>
                                        )}
                                    </div>
                                    {/* ê¸°ë³¸ ìƒíƒœì—ì„œëŠ” ë©”ëª¨ ë¯¸ë¦¬ë³´ê¸°ë§Œ */}
                                    {!expanded && task.memo && (
                                        <div className={cn(
                                            "text-sm leading-relaxed truncate",
                                            task.checked ? "text-gray-400" : "text-gray-500"
                                        )}>
                                            ğŸ’¬ {task.memo.substring(0, 50)}{task.memo.length > 50 ? '...' : ''}
                                        </div>
                                    )}
                                    
                                    {/* í¼ì³ì§„ ìƒíƒœì—ì„œëŠ” ì „ì²´ ë©”ëª¨ì™€ ë§í¬ */}
                                    {expanded && task.memo && (
                                        <div className={cn(
                                            "text-sm leading-relaxed mt-3 p-3 bg-gray-50 rounded-lg",
                                            task.checked ? "text-gray-400" : "text-gray-600"
                                        )}>
                                            <div className="font-medium text-gray-700 mb-2">ğŸ’¬ ë©”ëª¨:</div>
                                            <LinkifiedText 
                                                text={task.memo}
                                                className="leading-relaxed"
                                            />
                                        </div>
                                    )}
                                    
                                    {/* í¼ì³ì§„ ìƒíƒœì—ì„œë§Œ ì´ë¯¸ì§€ í‘œì‹œ */}
                                    {expanded && <TaskImages taskId={task.id} />}
                                    
                                    {/* ì ‘íŒ ìƒíƒœì—ì„œëŠ” ì´ë¯¸ì§€ ê°œìˆ˜ë§Œ í‘œì‹œ */}
                                    {!expanded && <TaskImageIndicator taskId={task.id} />}
                                </div>
                            </div>
                            
                            <div className="flex items-center justify-between text-sm text-gray-500">
                                <div className="flex items-center gap-4">
                                    {task.due && (
                                        <span className={cn(
                                            "flex items-center gap-1 px-2 py-1 rounded-lg",
                                            isOverdue ? "text-red-600 font-medium bg-red-50" : "bg-gray-100"
                                        )}>
                                            ğŸ“… {fmtDate(task.due)}
                                            {isOverdue && " âš ï¸"}
                                        </span>
                                    )}
                                </div>
                                <div className="flex items-center gap-3 text-xs text-gray-400">
                                    {task.createdAt && (
                                        <span title={`ìƒì„±: ${new Date(task.createdAt).toLocaleString('ko-KR')}`}>
                                            ğŸ†• {fmtDateTime(task.createdAt)}
                                        </span>
                                    )}
                                    {task.updatedAt && task.updatedAt !== task.createdAt && (
                                        <span title={`ìˆ˜ì •: ${new Date(task.updatedAt).toLocaleString('ko-KR')}`}>
                                            ğŸ“ {fmtDateTime(task.updatedAt)}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                        
                        <div className="flex items-center gap-1 task-actions">
                            <button
                                onClick={() => onTogglePin(task.id)}
                                className={cn(
                                    "p-2 rounded-xl transition-all duration-200",
                                    task.pinned 
                                        ? "text-yellow-600 hover:text-yellow-700 bg-yellow-50 hover:bg-yellow-100" 
                                        : "text-gray-400 hover:text-yellow-600 hover:bg-yellow-50"
                                )}
                                title={task.pinned ? "ê³ ì • í•´ì œ" : "ìƒë‹¨ ê³ ì •"}
                            >
                                <span className="text-lg">ğŸ“Œ</span>
                            </button>
                            <button
                                onClick={handleEditClick}
                                className="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-all duration-200"
                                title="í¸ì§‘"
                            >
                                <span className="text-lg">âœï¸</span>
                            </button>
                            <button
                                onClick={() => onDelete(task.id)}
                                className="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-xl transition-all duration-200"
                                title="ì‚­ì œ"
                            >
                                <span className="text-lg">ğŸ—‘ï¸</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }, (prevProps, nextProps) => {
            return prevProps.task.id === nextProps.task.id &&
                   prevProps.task.title === nextProps.task.title &&
                   prevProps.task.checked === nextProps.task.checked &&
                   prevProps.task.priority === nextProps.task.priority &&
                   prevProps.task.due === nextProps.task.due &&
                   prevProps.task.memo === nextProps.task.memo &&
                   prevProps.task.pinned === nextProps.task.pinned &&
                   prevProps.task.categoryId === nextProps.task.categoryId &&
                   prevProps.index === nextProps.index;
        });

        // =============== Authentication Component ===============
        function AuthOverlay() {
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleGoogleSignIn = async () => {
                setLoading(true);
                setError(null);
                try {
                    await userManager.signInWithGoogle();
                } catch (err) {
                    setError('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    console.error('Sign in error:', err);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="auth-overlay">
                    <div className="auth-modal">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mx-auto mb-4">
                                <span className="text-3xl">âœ…</span>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">TodoMaster</h2>
                            <p className="text-gray-600">ëª¨ë“  ê¸°ê¸°ì—ì„œ ë™ê¸°í™”ë˜ëŠ” ìŠ¤ë§ˆíŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</p>
                        </div>

                        <div className="space-y-4">
                            <button
                                onClick={handleGoogleSignIn}
                                disabled={loading}
                                className="w-full px-6 py-3 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 flex items-center justify-center gap-3 transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <svg className="w-5 h-5" viewBox="0 0 24 24">
                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                {loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'Googleë¡œ ê³„ì†í•˜ê¸°'}
                            </button>

                            <button
                                onClick={() => window.location.reload()}
                                className="w-full px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all duration-200"
                            >
                                ë¡œì»¬ ì €ì¥ì†Œë¡œ ê³„ì†í•˜ê¸°
                            </button>
                            
                            <div className="border-t pt-4">
                                <button
                                    onClick={() => window.location.href = '/feedback.html'}
                                    className="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl hover:from-purple-600 hover:to-pink-600 transition-all duration-200 flex items-center justify-center gap-2"
                                >
                                    ğŸ’¬ í”¼ë“œë°± ë° ê°œì„ ì‚¬í•­ ì œì•ˆ
                                </button>
                            </div>
                        </div>

                        {error && (
                            <div className="mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm">
                                {error}
                            </div>
                        )}

                        <div className="mt-6 pt-6 border-t border-gray-200">
                            <p className="text-xs text-gray-500 text-center">
                                ë¡œê·¸ì¸í•˜ë©´ ëª¨ë“  ê¸°ê¸°ì—ì„œ ë°ì´í„°ê°€ ìë™ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤.
                                ë¡œì»¬ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ë©´ í˜„ì¬ ë¸Œë¼ìš°ì €ì—ë§Œ ë°ì´í„°ê°€ ì €ì¥ë©ë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // =============== User Profile Component ===============
        function UserProfile() {
            const [dropdownOpen, setDropdownOpen] = useState(false);
            const user = userManager.currentUser;
            const profile = userManager.userProfile;

            if (!user) return null;

            return (
                <div className="user-profile-button relative flex items-center gap-2">
                    <button
                        onClick={() => setDropdownOpen(!dropdownOpen)}
                        className="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-all duration-200"
                    >
                        {profile?.avatar_url ? (
                            <img src={profile.avatar_url} className="w-8 h-8 rounded-full" />
                        ) : (
                            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold">
                                {profile?.full_name?.charAt(0) || user.email?.charAt(0).toUpperCase()}
                            </div>
                        )}
                        <span className="text-sm font-medium text-gray-700">
                            {profile?.full_name || user.email?.split('@')[0]}
                        </span>
                        <svg className="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    
                    {/* í”¼ë“œë°± ë²„íŠ¼ */}
                    <button
                        onClick={() => window.location.href = '/feedback.html'}
                        className="px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 text-sm font-medium flex items-center gap-1"
                        title="í”¼ë“œë°±"
                    >
                        ğŸ’¬ í”¼ë“œë°±
                    </button>
                    
                    {/* í•­ìƒ ë³´ì´ëŠ” ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */}
                    <button
                        onClick={async () => {
                            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                try {
                                    await userManager.signOut();
                                } catch (error) {
                                    console.error('Logout error:', error);
                                } finally {
                                    // Always reload regardless of signOut result
                                    window.location.href = window.location.href;
                                }
                            }
                        }}
                        className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all duration-200 text-sm font-medium"
                        title="ë¡œê·¸ì•„ì›ƒ"
                    >
                        ë¡œê·¸ì•„ì›ƒ
                    </button>

                    <div className={`user-dropdown ${dropdownOpen ? 'show' : ''}`}>
                        <div className="p-3 border-b border-gray-100">
                            <div className="text-sm font-medium text-gray-900">{profile?.full_name}</div>
                            <div className="text-xs text-gray-500">{user.email}</div>
                            <div className="text-xs text-gray-400 mt-1">
                                {profile?.subscription_tier === 'free' ? 'ë¬´ë£Œ í”Œëœ' : 
                                 profile?.subscription_tier === 'basic' ? 'ë² ì´ì§ í”Œëœ' :
                                 profile?.subscription_tier === 'premium' ? 'í”„ë¦¬ë¯¸ì—„ í”Œëœ' : 'ì—”í„°í”„ë¼ì´ì¦ˆ'}
                            </div>
                        </div>
                        <div className="py-1">
                            {userManager.isAdmin() && (
                                <a href="admin.html" className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    ğŸ› ï¸ ê´€ë¦¬ì íŒ¨ë„
                                </a>
                            )}
                            <a href="dashboard.html" className="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                ğŸ“Š ëŒ€ì‹œë³´ë“œ
                            </a>
                            <button
                                onClick={async () => {
                                    try {
                                        await userManager.signOut();
                                    } catch (error) {
                                        console.error('Logout error:', error);
                                    } finally {
                                        window.location.href = window.location.href;
                                    }
                                }}
                                className="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                            >
                                ğŸšª ë¡œê·¸ì•„ì›ƒ
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // =============== Main App Component ===============
        function App() {
            const [categories, setCategories] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [selectedCat, setSelectedCat] = useState("all");
            const [query, setQuery] = useState("");
            const [debouncedQuery, setDebouncedQuery] = useState("");
            const [statusFilter, setStatusFilter] = useState("all");
            const [prioFilter, setPrioFilter] = useState("all");
            const [sortBy, setSortBy] = useState("order");
            const [settingsOpen, setSettingsOpen] = useState(false);
            const [newCatName, setNewCatName] = useState("");
            const [selectedEmoji, setSelectedEmoji] = useState("ğŸ“");
            const [showEmojiPicker, setShowEmojiPicker] = useState(false);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [authLoading, setAuthLoading] = useState(true);
            const [soundOn, setSoundOn] = useState(true);
            const [fontSize, setFontSize] = useState(16);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [editingCatId, setEditingCatId] = useState(null);
            const [editCatName, setEditCatName] = useState("");
            const [editCatEmoji, setEditCatEmoji] = useState("");
            const [showEditEmojiPicker, setShowEditEmojiPicker] = useState(false);
            const [quickTaskText, setQuickTaskText] = useState("");
            const [showSearchResults, setShowSearchResults] = useState(false);
            const [highlightedTaskId, setHighlightedTaskId] = useState(null);
            const [showAddCategory, setShowAddCategory] = useState(false);
            const [showSearch, setShowSearch] = useState(false);
            const fileInputRef = useRef(null);
            const textFileInputRef = useRef(null);

            // Debounce search query
            useEffect(() => {
                const timer = setTimeout(() => {
                    setDebouncedQuery(query);
                    setShowSearchResults(query.length > 0);
                }, 300);
                return () => clearTimeout(timer);
            }, [query]);

            // Check authentication and load data on mount
            useEffect(() => {
                async function init() {
                    console.log('Checking authentication...');
                    // Check authentication status
                    const { data: { session } } = await supabase.auth.getSession();
                    if (session) {
                        console.log('User authenticated:', session.user.email);
                        setIsAuthenticated(true);
                        
                        // Update sync status to show we're syncing
                        const indicator = document.getElementById('sync-indicator');
                        if (indicator) {
                            indicator.className = 'sync-indicator syncing';
                            const statusText = indicator.querySelector('.sync-text');
                            if (statusText) {
                                statusText.textContent = 'ë™ê¸°í™” ì¤‘';
                            }
                        }
                        
                        // Initialize sync manager
                        try {
                            await syncManager.initializeSync();
                            console.log('Sync initialized successfully');
                        } catch (error) {
                            console.error('Sync initialization error:', error);
                            // Still allow local mode
                            const indicator = document.getElementById('sync-indicator');
                            if (indicator) {
                                indicator.className = 'sync-indicator offline';
                                const statusText = indicator.querySelector('.sync-text');
                                if (statusText) {
                                    statusText.textContent = 'ë¡œì»¬ ëª¨ë“œ (ë™ê¸°í™” ì‹¤íŒ¨)';
                                }
                            }
                        }
                    } else {
                        console.log('No active session found');
                        // Show auth screen for new users or offer local storage option
                        setIsAuthenticated(false);
                        
                        // Update sync status to offline
                        const indicator = document.getElementById('sync-indicator');
                        if (indicator) {
                            indicator.className = 'sync-indicator offline';
                            const statusText = indicator.querySelector('.sync-text');
                            if (statusText) {
                                statusText.textContent = 'ì˜¤í”„ë¼ì¸';
                            }
                        }
                    }
                    setAuthLoading(false);
                    
                    // Load data
                    await loadAllData();
                    
                    // í°íŠ¸ í¬ê¸° ì„¤ì • ë¡œë“œ
                    const savedFontSize = localStorage.getItem('todoMasterFontSize');
                    if (savedFontSize) {
                        setFontSize(parseInt(savedFontSize));
                    }
                }
                init();

                // Set up real-time sync for todo updates
                window.updateTodoUI = () => {
                    loadAllData();
                };
            }, []);

            // í°íŠ¸ í¬ê¸° ë³€ê²½ì‹œ ì €ì¥ ë° ì ìš©
            useEffect(() => {
                localStorage.setItem('todoMasterFontSize', fontSize.toString());
                document.documentElement.style.fontSize = `${fontSize}px`;
            }, [fontSize]);

            async function loadAllData() {
                // Wait for sync to complete if user is logged in
                if (userManager.isLoggedIn() && syncManager.syncStatus === 'syncing') {
                    // Wait a bit for sync to complete
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // Load from local storage (which now has cloud data if logged in)
                const cats = await db.getCategories();
                const tasks = await db.getTasks();
                
                // ê¸°ì¡´ ì‘ì—…ë“¤ì— createdAt, updatedAtì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
                const tasksWithDates = tasks.map(task => ({
                    ...task,
                    createdAt: task.createdAt || new Date().toISOString(),
                    updatedAt: task.updatedAt || task.createdAt || new Date().toISOString()
                }));
                
                setCategories([{ id: "all", name: "ì „ì²´", emoji: "ğŸ“‹", builtin: true }, ...cats]);
                setTasks(tasksWithDates);
                
                // Save to cloud if authenticated
                if (userManager.isLoggedIn()) {
                    await userManager.saveTodos(tasksWithDates);
                }
            }

            // Stats
            const stats = useMemo(() => {
                const filtered = selectedCat === "all" ? tasks : tasks.filter(t => t.categoryId === selectedCat);
                const completed = filtered.filter(t => t.checked).length;
                const total = filtered.length;
                return { completed, total, progress: total > 0 ? Math.round((completed / total) * 100) : 0 };
            }, [tasks, selectedCat]);

            // Filtered and sorted tasks
            const filteredTasks = useMemo(() => {
                let result = tasks;

                if (selectedCat !== "all") {
                    result = result.filter(t => t.categoryId === selectedCat);
                }

                if (debouncedQuery.trim()) {
                    const q = debouncedQuery.toLowerCase();
                    result = result.filter(t => 
                        t.title.toLowerCase().includes(q) || 
                        (t.memo && t.memo.toLowerCase().includes(q))
                    );
                }

                if (statusFilter === "completed") {
                    result = result.filter(t => t.checked);
                } else if (statusFilter === "pending") {
                    result = result.filter(t => !t.checked);
                }

                if (prioFilter !== "all") {
                    result = result.filter(t => t.priority === prioFilter);
                }

                result.sort((a, b) => {
                    if (a.pinned && !b.pinned) return -1;
                    if (!a.pinned && b.pinned) return 1;
                    
                    if (sortBy === "priority") {
                        const prio = { none: 0, low: 1, medium: 2, high: 3 };
                        return prio[b.priority] - prio[a.priority];
                    } else if (sortBy === "due") {
                        if (!a.due && !b.due) return 0;
                        if (!a.due) return 1;
                        if (!b.due) return -1;
                        return new Date(a.due) - new Date(b.due);
                    } else if (sortBy === "name") {
                        return a.title.localeCompare(b.title);
                    } else if (sortBy === "created") {
                        return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
                    } else if (sortBy === "updated") {
                        return new Date(b.updatedAt || b.createdAt || 0) - new Date(a.updatedAt || a.createdAt || 0);
                    }
                    return a.order - b.order;
                });

                return result;
            }, [tasks, selectedCat, debouncedQuery, statusFilter, prioFilter, sortBy]);

            // Random emoji generator for categories
            function getRandomCategoryEmoji() {
                const categoryEmojis = [
                    "ğŸ“", "ğŸ“‚", "ğŸ—‚ï¸", "ğŸ“‹", "ğŸ“Œ", "ğŸ“", "ğŸ”–", "ğŸ·ï¸", 
                    "ğŸ“¦", "ğŸ“«", "ğŸ“ª", "ğŸ—³ï¸", "ğŸ“", "ğŸ“„", "ğŸ“‘", "ğŸ—’ï¸",
                    "ğŸ“”", "ğŸ““", "ğŸ“•", "ğŸ“—", "ğŸ“˜", "ğŸ“™", "ğŸ“š", "ğŸ“–",
                    "ğŸ”®", "ğŸ’", "ğŸ¯", "ğŸ¨", "ğŸ­", "ğŸª", "ğŸ²", "ğŸ¯",
                    "â­", "ğŸŒŸ", "ğŸ’«", "âœ¨", "ğŸ”¥", "ğŸ’¥", "âš¡", "ğŸŒˆ"
                ];
                return categoryEmojis[Math.floor(Math.random() * categoryEmojis.length)];
            }

            // Actions
            async function addCategory() {
                if (!newCatName.trim()) return;
                const cat = {
                    id: uid(),
                    name: newCatName.trim(),
                    emoji: selectedEmoji,
                    builtin: false,
                };
                await db.saveCategory(cat);
                setCategories(prev => [...prev, cat]);
                setNewCatName("");
                setSelectedEmoji("ğŸ“");
                setShowEmojiPicker(false);
            }

            async function deleteCategory(id) {
                if (!confirm("ì´ ì¹´í…Œê³ ë¦¬ì™€ ê´€ë ¨ëœ ëª¨ë“  ì‘ì—…ì´ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
                await db.deleteCategory(id);
                setCategories(prev => prev.filter(c => c.id !== id));
                setTasks(prev => prev.filter(t => t.categoryId !== id));
                if (selectedCat === id) setSelectedCat("all");
            }

            async function renameCategory(catId, newName, newEmoji) {
                const cat = categories.find(c => c.id === catId);
                if (!cat || cat.builtin) return;
                
                const updated = { ...cat, name: newName, emoji: newEmoji };
                await db.saveCategory(updated);
                setCategories(prev => prev.map(c => c.id === catId ? updated : c));
            }

            async function addTask(taskTitle = "ìƒˆ ì‘ì—…") {
                if (selectedCat === "all") {
                    alert("ì‘ì—…ì„ ì¶”ê°€í•˜ë ¤ë©´ íŠ¹ì • ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }
                const now = new Date().toISOString();
                const task = {
                    id: uid(),
                    title: taskTitle.trim() || "ìƒˆ ì‘ì—…",
                    checked: false,
                    priority: "none",
                    due: "",
                    memo: "",
                    categoryId: selectedCat,
                    order: 0, // ìƒˆ ì‘ì—…ì€ í•­ìƒ ë§¨ ìœ„ë¡œ
                    createdAt: now,
                    updatedAt: now,
                };
                try {
                    // ê¸°ì¡´ ì‘ì—…ë“¤ì˜ orderë¥¼ 1ì”© ì¦ê°€
                    const updatedTasks = tasks.map(t => ({ ...t, order: t.order + 1 }));
                    for (const t of updatedTasks) {
                        await db.saveTask(t);
                    }
                    
                    await db.saveTask(task);
                    const newTasks = [task, ...updatedTasks];
                    setTasks(newTasks);
                    
                    // Sync with cloud if authenticated
                    if (userManager.isLoggedIn()) {
                        await userManager.saveTodos(newTasks);
                    }
                } catch (error) {
                    console.error('ì‘ì—… ì¶”ê°€ ì‹¤íŒ¨:', error);
                    alert('ì‘ì—… ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }

            async function addQuickTask() {
                if (!quickTaskText.trim()) return;
                await addTask(quickTaskText);
                setQuickTaskText("");
            }

            async function updateTask(id, updates) {
                const task = tasks.find(t => t.id === id);
                if (!task) return;
                const updated = { 
                    ...task, 
                    ...updates, 
                    updatedAt: new Date().toISOString() 
                };
                await db.saveTask(updated);
                setTasks(prev => prev.map(t => t.id === id ? updated : t));
                
                // ì¹´í…Œê³ ë¦¬ê°€ ë³€ê²½ëœ ê²½ìš° í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¡œ ìë™ ì´ë™
                if (updates.categoryId && updates.categoryId !== task.categoryId) {
                    setSelectedCat(updates.categoryId);
                    // ëª¨ë°”ì¼ì—ì„œëŠ” ë©”ë‰´ë„ ë‹«ê¸°
                    if (window.innerWidth <= 768) {
                        setMobileMenuOpen(false);
                    }
                }
            }

            async function togglePinTask(id) {
                const task = tasks.find(t => t.id === id);
                if (!task) return;
                await updateTask(id, { pinned: !task.pinned });
            }

            async function deleteTask(id) {
                await db.deleteTask(id);
                setTasks(prev => prev.filter(t => t.id !== id));
            }

            async function toggleTask(id) {
                const t = tasks.find(x => x.id === id);
                if (!t) return;
                const nextChecked = !t.checked;
                
                if (soundOn) {
                    if (nextChecked) playSuccess(); 
                    else playUndo();
                }
                
                const taskEl = document.querySelector(`[data-task-id="${id}"]`);
                if (taskEl && nextChecked) {
                    taskEl.classList.add('task-complete');
                    setTimeout(() => taskEl.classList.remove('task-complete'), 400);
                }
                
                await updateTask(id, { checked: nextChecked });
            }

            async function reorderTasks(draggedTask, targetIndex, position) {
                const currentTasks = [...filteredTasks];
                const draggedIndex = currentTasks.findIndex(t => t.id === draggedTask.id);
                
                if (draggedIndex === -1) return;
                
                currentTasks.splice(draggedIndex, 1);
                
                let newIndex = targetIndex;
                if (draggedIndex < targetIndex) newIndex--;
                if (position === 'after') newIndex++;
                
                currentTasks.splice(newIndex, 0, draggedTask);
                
                const updatedTasks = currentTasks.map((task, index) => ({
                    ...task,
                    order: index
                }));
                
                for (const task of updatedTasks) {
                    await db.saveTask(task);
                }
                
                setTasks(prev => {
                    const updated = [...prev];
                    updatedTasks.forEach(updatedTask => {
                        const index = updated.findIndex(t => t.id === updatedTask.id);
                        if (index !== -1) {
                            updated[index] = updatedTask;
                        }
                    });
                    return updated;
                });
            }

            async function clearCompleted() {
                if (!confirm("ì™„ë£Œëœ ëª¨ë“  ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
                const completedIds = tasks.filter(t => t.checked).map(t => t.id);
                for (const id of completedIds) {
                    await db.deleteTask(id);
                }
                setTasks(prev => prev.filter(t => !t.checked));
            }

            async function exportData() {
                const data = await db.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `todomaster-backup-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            async function importData() {
                fileInputRef.current?.click();
            }

            async function handleFileImport(event) {
                const file = event.target.files?.[0];
                if (!file) return;
                
                const text = await file.text();
                const success = await db.importData(text);
                if (success) {
                    await loadAllData();
                    alert("ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!");
                } else {
                    alert("íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
                event.target.value = '';
            }

            function startEditCategory(catId) {
                const cat = categories.find(c => c.id === catId);
                if (!cat || cat.builtin) return;
                setEditingCatId(catId);
                setEditCatName(cat.name);
                setEditCatEmoji(cat.emoji || "ğŸ“");
            }

            function saveEditCategory() {
                if (!editCatName.trim()) return;
                renameCategory(editingCatId, editCatName.trim(), editCatEmoji);
                setEditingCatId(null);
                setEditCatName("");
                setEditCatEmoji("");
            }

            function cancelEditCategory() {
                setEditingCatId(null);
                setEditCatName("");
                setEditCatEmoji("");
            }
            
            // Jump to task when clicking search result
            function jumpToTask(taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // Switch to task's category
                setSelectedCat(task.categoryId);
                
                // Clear search
                setQuery("");
                setShowSearchResults(false);
                
                // Highlight the task
                setHighlightedTaskId(taskId);
                
                // Scroll to task after DOM updates
                setTimeout(() => {
                    const element = document.querySelector(`[data-task-id="${taskId}"]`);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        element.classList.add('highlight-animation');
                        setTimeout(() => {
                            element.classList.remove('highlight-animation');
                            setHighlightedTaskId(null);
                        }, 2000);
                    }
                }, 100);
            }

            // =============== í°íŠ¸ í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥ ===============
            function increaseFontSize() {
                setFontSize(prev => Math.min(prev + 1, 24)); // ìµœëŒ€ 24px
            }

            function decreaseFontSize() {
                setFontSize(prev => Math.max(prev - 1, 12)); // ìµœì†Œ 12px
            }

            function resetFontSize() {
                setFontSize(16); // ê¸°ë³¸ê°’ 16px
            }

            // =============== ëª¨ë°”ì¼ ë©”ë‰´ ê¸°ëŠ¥ ===============
            function toggleMobileMenu() {
                setMobileMenuOpen(prev => !prev);
            }

            function closeMobileMenu() {
                setMobileMenuOpen(false);
            }

            // ëª¨ë°”ì¼ì—ì„œ ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ë©”ë‰´ ìë™ ë‹«ê¸°
            function handleMobileCategorySelect(categoryId) {
                setSelectedCat(categoryId);
                if (window.innerWidth <= 768) {
                    closeMobileMenu();
                }
            }

            // =============== í…ìŠ¤íŠ¸ ì¶”ì¶œ/ì—…ë¡œë“œ ê¸°ëŠ¥ ===============
            function exportToText() {
                const categoryMap = {};
                
                // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì‘ì—… ë¶„ë¥˜
                categories.filter(c => c.id !== "all").forEach(cat => {
                    categoryMap[cat.name] = [];
                });
                
                tasks.forEach(task => {
                    const category = categories.find(c => c.id === task.categoryId);
                    if (category && category.id !== "all") {
                        const taskInfo = {
                            title: task.title,
                            memo: task.memo,
                            checked: task.checked,
                            priority: task.priority,
                            due: task.due
                        };
                        categoryMap[category.name].push(taskInfo);
                    }
                });
                
                // í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ë³€í™˜
                let textContent = "ğŸ“‹ TodoMaster ì‘ì—… ëª©ë¡\n";
                textContent += "=" + "=".repeat(50) + "\n\n";
                
                Object.keys(categoryMap).forEach(categoryName => {
                    const tasks = categoryMap[categoryName];
                    if (tasks.length === 0) return;
                    
                    textContent += `ğŸ“‚ ${categoryName}\n`;
                    textContent += "-".repeat(30) + "\n";
                    
                    tasks.forEach(task => {
                        const checkbox = task.checked ? "âœ…" : "â¬œ";
                        const priority = task.priority !== "none" ? 
                            ` [${task.priority === 'high' ? 'ğŸ”´ë†’ìŒ' : task.priority === 'medium' ? 'ğŸŸ¡ë³´í†µ' : task.priority === 'low' ? 'ğŸ”µë‚®ìŒ' : ''}]` : "";
                        const dueDate = task.due ? ` (ğŸ“…${fmtDate(task.due)})` : "";
                        
                        textContent += `  ${checkbox} ${task.title}${priority}${dueDate}\n`;
                        
                        if (task.memo) {
                            textContent += `     ğŸ’¬ ${task.memo}\n`;
                        }
                    });
                    textContent += "\n";
                });
                
                textContent += `\nğŸ“Š í†µê³„\n`;
                textContent += "-".repeat(30) + "\n";
                textContent += `ì´ ì‘ì—…: ${tasks.length}ê°œ\n`;
                textContent += `ì™„ë£Œ: ${tasks.filter(t => t.checked).length}ê°œ\n`;
                textContent += `ë¯¸ì™„ë£Œ: ${tasks.filter(t => !t.checked).length}ê°œ\n`;
                textContent += `ì§„í–‰ë¥ : ${stats.progress}%\n\n`;
                textContent += `ğŸ“… ì¶”ì¶œì¼: ${new Date().toLocaleString('ko-KR')}\n`;
                
                // ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([textContent], { type: 'text/plain; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `TodoMaster-ëª©ë¡-${new Date().toISOString().slice(0, 10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            }
            
            function parseTextFile(textContent) {
                const lines = textContent.split('\n');
                const result = { categories: [], tasks: [] };
                let currentCategory = null;
                let currentCategoryId = null;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // ì¹´í…Œê³ ë¦¬ ë¼ì¸ ê°ì§€: "ğŸ“‚ ì¹´í…Œê³ ë¦¬ëª…" ë˜ëŠ” "ì¹´í…Œê³ ë¦¬ëª…" (ë§¨ ì•)
                    if (line.startsWith('ğŸ“‚ ') || (line && !line.startsWith(' ') && !line.startsWith('-') && !line.startsWith('=') && !line.startsWith('ğŸ“‹') && !line.startsWith('ğŸ“Š') && !line.startsWith('ğŸ“…') && !line.includes('='))) {
                        currentCategory = line.replace('ğŸ“‚ ', '').trim();
                        if (currentCategory && !['í†µê³„', 'ì¶”ì¶œì¼'].includes(currentCategory)) {
                            currentCategoryId = uid();
                            result.categories.push({
                                id: currentCategoryId,
                                name: currentCategory,
                                emoji: "ğŸ“",
                                builtin: false
                            });
                        }
                        continue;
                    }
                    
                    // ì‘ì—… ë¼ì¸ ê°ì§€: "  âœ…" ë˜ëŠ” "  â¬œ" ë˜ëŠ” "- " ë˜ëŠ” "  - "
                    if ((line.startsWith('  âœ…') || line.startsWith('  â¬œ') || line.startsWith('- ') || line.startsWith('  - ')) && currentCategoryId) {
                        let taskLine = line.replace(/^(\s*)([âœ…â¬œ\-]\s*)/, '').trim();
                        const isChecked = line.includes('âœ…');
                        
                        // ìš°ì„ ìˆœìœ„ ì¶”ì¶œ
                        let priority = "none";
                        if (taskLine.includes('[ğŸ”´ë†’ìŒ]')) {
                            priority = "high";
                            taskLine = taskLine.replace(/\s*\[ğŸ”´ë†’ìŒ\]\s*/, '');
                        } else if (taskLine.includes('[ğŸŸ¡ë³´í†µ]')) {
                            priority = "medium"; 
                            taskLine = taskLine.replace(/\s*\[ğŸŸ¡ë³´í†µ\]\s*/, '');
                        } else if (taskLine.includes('[ğŸ”µë‚®ìŒ]')) {
                            priority = "low";
                            taskLine = taskLine.replace(/\s*\[ğŸ”µë‚®ìŒ\]\s*/, '');
                        }
                        
                        // ë§ˆê°ì¼ ì¶”ì¶œ
                        let due = "";
                        const dueDateMatch = taskLine.match(/\(ğŸ“…([^)]+)\)/);
                        if (dueDateMatch) {
                            due = dueDateMatch[1];
                            taskLine = taskLine.replace(/\s*\(ğŸ“…[^)]+\)\s*/, '');
                        }
                        
                        // ë©”ëª¨ í™•ì¸ (ë‹¤ìŒ ë¼ì¸)
                        let memo = "";
                        if (i + 1 < lines.length) {
                            const nextLine = lines[i + 1].trim();
                            if (nextLine.startsWith('ğŸ’¬')) {
                                memo = nextLine.replace('ğŸ’¬', '').trim();
                                i++; // ë‹¤ìŒ ë¼ì¸ ìŠ¤í‚µ
                            }
                        }
                        
                        const now = new Date().toISOString();
                        result.tasks.push({
                            id: uid(),
                            title: taskLine.trim() || "ë¬´ì œ",
                            checked: isChecked,
                            priority: priority,
                            due: due,
                            memo: memo,
                            categoryId: currentCategoryId,
                            order: result.tasks.length,
                            createdAt: now,
                            updatedAt: now
                        });
                    }
                }
                
                return result;
            }
            
            async function importTextFile() {
                textFileInputRef.current?.click();
            }
            
            async function handleTextFileImport(event) {
                const file = event.target.files?.[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const parsed = parseTextFile(text);
                    
                    if (parsed.categories.length === 0 && parsed.tasks.length === 0) {
                        alert("ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.");
                        return;
                    }
                    
                    const confirmMsg = `${parsed.categories.length}ê°œ ì¹´í…Œê³ ë¦¬ì™€ ${parsed.tasks.length}ê°œ ì‘ì—…ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ì¡´ ë°ì´í„°ëŠ” ìœ ì§€ë˜ê³  ìƒˆ ë°ì´í„°ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.`;
                    if (!confirm(confirmMsg)) return;
                    
                    // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
                    for (const cat of parsed.categories) {
                        await db.saveCategory(cat);
                    }
                    
                    // ì‘ì—… ì¶”ê°€
                    for (const task of parsed.tasks) {
                        await db.saveTask(task);
                    }
                    
                    await loadAllData();
                    alert(`ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!\nì¹´í…Œê³ ë¦¬: ${parsed.categories.length}ê°œ\nì‘ì—…: ${parsed.tasks.length}ê°œ`);
                    
                } catch (error) {
                    console.error('í…ìŠ¤íŠ¸ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
                event.target.value = '';
            }

            const selectedCategory = categories.find(c => c.id === selectedCat);
            const hasCompletedTasks = filteredTasks.some(t => t.checked);

            // Show loading screen while checking auth
            if (authLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mx-auto mb-4 animate-pulse">
                                <span className="text-3xl">âœ…</span>
                            </div>
                            <p className="text-gray-600">ë¡œë”© ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            // Show auth screen if not authenticated and first visit
            if (!isAuthenticated && !localStorage.getItem('skipAuth')) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
                                <AuthOverlay />
                        <button
                            onClick={() => {
                                localStorage.setItem('skipAuth', 'true');
                                setIsAuthenticated(false);
                                window.location.reload();
                            }}
                            className="absolute bottom-4 right-4 text-xs text-gray-500 hover:text-gray-700"
                        >
                            ë¡œê·¸ì¸ ì—†ì´ ê³„ì†í•˜ê¸°
                        </button>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 text-gray-900">
                    {/* Mobile Menu Button */}
                    <button 
                        className="mobile-menu-button"
                        onClick={toggleMobileMenu}
                        aria-label="ë©”ë‰´ ì—´ê¸°"
                    >
                        â˜°
                    </button>

                    {/* Mobile Overlay */}
                    <div 
                        className={cn("mobile-overlay", mobileMenuOpen && "show")}
                        onClick={closeMobileMenu}
                    ></div>


                    {/* Sidebar */}
                    <aside className={cn("sidebar p-6", mobileMenuOpen && "mobile-open", showSearchResults && debouncedQuery && "search-open")}>
                        <div className="mb-8">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                                    <span className="text-white text-lg font-bold">âœ“</span>
                                </div>
                                <div className="flex-1">
                                    <h1 className="text-xl font-bold text-gray-800">TodoMaster</h1>
                                    <p className="text-xs text-gray-500">ìŠ¤ë§ˆíŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</p>
                                </div>
                                <div id="sync-indicator" className="sync-indicator offline flex items-center gap-1 px-2 py-1 rounded-lg bg-gray-100" title="ë™ê¸°í™” ìƒíƒœ">
                                    <span className="sync-dot w-2 h-2 rounded-full bg-gray-400"></span>
                                    <span className="sync-text text-xs text-gray-600">ì˜¤í”„ë¼ì¸</span>
                                </div>
                            </div>
                            <div className="glassmorphism rounded-2xl p-4 mb-4 fade-in">
                                <div className="text-sm text-gray-600 mb-2">ì „ì²´ ì§„í–‰ë¥ </div>
                                <div className="text-2xl font-bold text-gray-800 mb-2">
                                    {stats.completed}/{stats.total}
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-3 mb-2">
                                    <div
                                        className="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500 progress-glow"
                                        style={{ width: `${stats.progress}%` }}
                                    ></div>
                                </div>
                                <div className="text-xs text-gray-500">{stats.progress}% ì™„ë£Œ</div>
                            </div>
                        </div>

                        {/* ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ */}
                        <div className="mb-6">
                            <div className="text-sm font-semibold mb-3 text-gray-700 flex items-center justify-between">
                                <span>ğŸ“‚ ì¹´í…Œê³ ë¦¬</span>
                                <div className="flex gap-1">
                                    <button
                                        onClick={() => setShowSearch(!showSearch)}
                                        className={cn("p-1.5 rounded hover:bg-gray-100 transition-colors", showSearch && "bg-gray-100")}
                                        title="ê²€ìƒ‰"
                                    >
                                        ğŸ”
                                    </button>
                                    <button
                                        onClick={() => setShowAddCategory(!showAddCategory)}
                                        className={cn("p-1.5 rounded hover:bg-gray-100 transition-colors", showAddCategory && "bg-gray-100")}
                                        title="ì¶”ê°€"
                                    >
                                        â•
                                    </button>
                                </div>
                            </div>
                            
                            {/* ê²€ìƒ‰ì°½ */}
                            {showSearch && (
                                <div className="mb-3" style={{ position: 'relative', zIndex: showSearchResults && debouncedQuery ? 2000 : 2 }}>
                                    <input
                                        value={query}
                                        onChange={(e) => setQuery(e.target.value)}
                                        onFocus={() => setShowSearchResults(true)}
                                        onBlur={() => setTimeout(() => setShowSearchResults(false), 200)}
                                        placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..."
                                        className="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-800 placeholder-gray-500"
                                        autoFocus
                                    />
                            
                            {/* Search Results Dropdown */}
                            {showSearchResults && debouncedQuery && debouncedQuery.length > 0 && (
                                <div 
                                    className="absolute left-0 right-0 mt-1 bg-white border-2 border-blue-300 rounded-xl shadow-2xl"
                                    style={{ 
                                        top: '100%',
                                        zIndex: 99999,
                                        maxHeight: '300px',
                                        overflowY: 'auto',
                                        overflowX: 'hidden',
                                        position: 'absolute'
                                    }}>
                                    {(() => {
                                        const searchResults = tasks.filter(t => 
                                            t.title.toLowerCase().includes(debouncedQuery.toLowerCase()) || 
                                            (t.memo && t.memo.toLowerCase().includes(debouncedQuery.toLowerCase()))
                                        );
                                        
                                        if (searchResults.length === 0) {
                                            return (
                                                <div className="p-4 text-center">
                                                    <div className="text-gray-400 mb-1">ğŸ”</div>
                                                    <div className="text-xs text-gray-600">ê²°ê³¼ ì—†ìŒ</div>
                                                </div>
                                            );
                                        }
                                        
                                        return (
                                            <>
                                                <div className="px-2 py-1 bg-blue-50 border-b border-blue-100 text-xs font-medium text-blue-700 sticky top-0">
                                                    {searchResults.length}ê°œ ê²°ê³¼
                                                </div>
                                                {searchResults.map(task => {
                                                    const category = categories.find(c => c.id === task.categoryId);
                                                    return (
                                                        <button
                                                            key={task.id}
                                                            onClick={() => jumpToTask(task.id)}
                                                            className="w-full p-2 text-left hover:bg-blue-50 border-b border-gray-100 transition-all hover:pl-3"
                                                        >
                                                            <div className="flex items-center gap-1 mb-0.5">
                                                                <span className="text-xs px-1 py-0.5 rounded bg-gray-100">
                                                                    {category?.emoji} {category?.name}
                                                                </span>
                                                                {task.checked && <span className="text-green-500 text-xs">âœ“</span>}
                                                            </div>
                                                            <div className="text-xs font-medium truncate">{task.title}</div>
                                                        </button>
                                                    );
                                                })}
                                            </>
                                        );
                                    })()}
                                    </div>
                                )}
                            </div>
                            )}
                            
                            {/* ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ */}
                            {showAddCategory && (
                                <div className="mb-3 p-2 bg-gray-50 rounded-lg" style={{ position: 'relative', zIndex: 1 }}>
                                <div className="flex gap-1">
                                    <button
                                        type="button"
                                        onClick={() => setShowEmojiPicker(!showEmojiPicker)}
                                        className="w-9 h-9 border border-gray-200 rounded-lg flex items-center justify-center text-base hover:bg-gray-50 transition-colors"
                                        title="ì´ëª¨ì§€"
                                    >
                                        {selectedEmoji}
                                    </button>
                                    <input
                                        value={newCatName}
                                        onChange={(e) => setNewCatName(e.target.value)}
                                        onKeyDown={(e) => e.key === "Enter" && addCategory()}
                                        placeholder="ì´ë¦„..."
                                        className="flex-1 min-w-0 px-3 py-2 h-9 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-800 placeholder-gray-500"
                                    />
                                    <button
                                        onClick={addCategory}
                                        disabled={!newCatName.trim()}
                                        className="px-4 h-9 text-sm rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium"
                                    >
                                        ì¶”ê°€
                                    </button>
                                </div>
                                
                                {showEmojiPicker && (
                                    <div className="bg-white border border-gray-200 rounded-lg p-2 shadow-lg" style={{ position: 'absolute', zIndex: 10, left: 0, right: 0 }}>
                                        <div className="grid grid-cols-8 gap-0.5 max-h-32" style={{ overflowY: 'auto', overflowX: 'hidden' }}>
                                            {["ğŸ“", "ğŸ“‚", "ğŸ—‚ï¸", "ğŸ“‹", "ğŸ“Œ", "ğŸ“", "ğŸ”–", "ğŸ·ï¸",
                                              "ğŸ“¦", "ğŸ“«", "ğŸ“ª", "ğŸ—³ï¸", "ğŸ“", "ğŸ“„", "ğŸ“‘", "ğŸ—’ï¸",
                                              "ğŸ“”", "ğŸ““", "ğŸ“•", "ğŸ“—", "ğŸ“˜", "ğŸ“™", "ğŸ“š", "ğŸ“–",
                                              "ğŸ”®", "ğŸ’", "ğŸ¯", "ğŸ¨", "ğŸ­", "ğŸª", "ğŸ²", "ğŸ®",
                                              "â­", "ğŸŒŸ", "ğŸ’«", "âœ¨", "ğŸ”¥", "ğŸ’¥", "âš¡", "ğŸŒˆ",
                                              "ğŸ ", "ğŸ¢", "ğŸ†", "ğŸ", "ğŸ‰", "ğŸŠ", "ğŸ’¼", "ğŸ’°",
                                              "ğŸ”§", "ğŸ”¨", "âš™ï¸", "ğŸ§°", "ğŸ”¬", "ğŸ”­", "ğŸ’»", "ğŸ–¥ï¸",
                                              "ğŸŒ¸", "ğŸŒº", "ğŸŒ»", "ğŸŒ¹", "ğŸŒ·", "ğŸŒ±", "ğŸŒ³", "ğŸ€"].map(emoji => (
                                                <button
                                                    key={emoji}
                                                    type="button"
                                                    onClick={() => {
                                                        setSelectedEmoji(emoji);
                                                        setShowEmojiPicker(false);
                                                    }}
                                                    className="w-7 h-7 flex items-center justify-center hover:bg-gray-100 rounded text-sm transition-colors"
                                                >
                                                    {emoji}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                            )}
                            
                            {/* ì¹´í…Œê³ ë¦¬ ëª©ë¡ */}
                            <div className="space-y-2">
                                {categories.map((c) => (
                                    <div
                                        key={c.id}
                                        className={cn(
                                            "flex items-center gap-2 px-3 py-2.5 rounded-xl cursor-pointer transition-all duration-300 card-hover",
                                            selectedCat === c.id 
                                                ? "category-active text-white shadow-lg" 
                                                : "glassmorphism hover:shadow-md"
                                        )}
                                        style={{ position: 'relative' }}
                                    >
                                        {editingCatId === c.id ? (
                                            <>
                                                <button
                                                    type="button"
                                                    onClick={() => setShowEditEmojiPicker(!showEditEmojiPicker)}
                                                    className="text-lg w-7 h-7 flex items-center justify-center hover:bg-gray-100 rounded transition-colors"
                                                >
                                                    {editCatEmoji}
                                                </button>
                                                <input
                                                    value={editCatName}
                                                    onChange={(e) => {
                                                        if (e.target.value.length <= 15) {
                                                            setEditCatName(e.target.value);
                                                        }
                                                    }}
                                                    placeholder="ì´ë¦„"
                                                    className="flex-1 min-w-0 px-2 text-sm bg-transparent border-b-2 border-blue-400 focus:border-blue-600 outline-none text-gray-800"
                                                    autoFocus
                                                    onFocus={(e) => e.target.select()}
                                                    onKeyDown={(e) => {
                                                        if (e.key === "Enter") { saveEditCategory(); setShowEditEmojiPicker(false); }
                                                        if (e.key === "Escape") { cancelEditCategory(); setShowEditEmojiPicker(false); }
                                                    }}
                                                />
                                                <div className="flex items-center gap-1">
                                                    <button
                                                        onClick={() => { saveEditCategory(); setShowEditEmojiPicker(false); }}
                                                        className="w-7 h-7 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded transition-colors"
                                                        title="ì €ì¥"
                                                    >
                                                        <span className="text-lg font-bold">âœ“</span>
                                                    </button>
                                                    <button
                                                        onClick={() => { cancelEditCategory(); setShowEditEmojiPicker(false); }}
                                                        className="w-7 h-7 flex items-center justify-center text-gray-500 hover:bg-red-50 hover:text-red-600 rounded transition-colors"
                                                        title="ì·¨ì†Œ"
                                                    >
                                                        <span className="text-lg">âœ•</span>
                                                    </button>
                                                </div>
                                                {showEditEmojiPicker && (
                                                    <div className="absolute left-0 right-0 top-full mt-1 bg-white border-2 border-gray-300 rounded-lg p-2 shadow-xl" style={{ zIndex: 50000 }}>
                                                        <div className="grid grid-cols-8 gap-0.5 max-h-32" style={{ overflowY: 'auto', overflowX: 'hidden' }}>
                                                            {["ğŸ“", "ğŸ“‚", "ğŸ—‚ï¸", "ğŸ“‹", "ğŸ“Œ", "ğŸ“", "ğŸ”–", "ğŸ·ï¸",
                                                              "ğŸ“¦", "ğŸ“«", "ğŸ“ª", "ğŸ—³ï¸", "ğŸ“", "ğŸ“„", "ğŸ“‘", "ğŸ—’ï¸",
                                                              "ğŸ“”", "ğŸ““", "ğŸ“•", "ğŸ“—", "ğŸ“˜", "ğŸ“™", "ğŸ“š", "ğŸ“–",
                                                              "ğŸ”®", "ğŸ’", "ğŸ¯", "ğŸ¨", "ğŸ­", "ğŸª", "ğŸ²", "ğŸ®",
                                                              "â­", "ğŸŒŸ", "ğŸ’«", "âœ¨", "ğŸ”¥", "ğŸ’¥", "âš¡", "ğŸŒˆ",
                                                              "ğŸ ", "ğŸ¢", "ğŸ†", "ğŸ", "ğŸ‰", "ğŸŠ", "ğŸ’¼", "ğŸ’°",
                                                              "ğŸ”§", "ğŸ”¨", "âš™ï¸", "ğŸ§°", "ğŸ”¬", "ğŸ”­", "ğŸ’»", "ğŸ–¥ï¸",
                                                              "ğŸŒ¸", "ğŸŒº", "ğŸŒ»", "ğŸŒ¹", "ğŸŒ·", "ğŸŒ±", "ğŸŒ³", "ğŸ€"].map(emoji => (
                                                                <button
                                                                    key={emoji}
                                                                    type="button"
                                                                    onClick={() => {
                                                                        setEditCatEmoji(emoji);
                                                                        setShowEditEmojiPicker(false);
                                                                    }}
                                                                    className="w-7 h-7 flex items-center justify-center hover:bg-gray-100 rounded text-sm transition-colors"
                                                                >
                                                                    {emoji}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </>
                                        ) : (
                                            <>
                                                <span 
                                                    className="text-lg w-6 text-center"
                                                    onClick={() => handleMobileCategorySelect(c.id)}
                                                >
                                                    {c.emoji || "ğŸ“"}
                                                </span>
                                                <div 
                                                    className="flex-1 min-w-0 font-medium text-sm truncate"
                                                    onClick={() => handleMobileCategorySelect(c.id)}
                                                    title={c.name}
                                                >
                                                    {c.name}
                                                </div>
                                                {!c.builtin && (
                                                    <div className="flex items-center gap-1">
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                startEditCategory(c.id);
                                                            }}
                                                            className="text-gray-400 hover:text-blue-600"
                                                            title="ìˆ˜ì •"
                                                        >
                                                            âœ
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                deleteCategory(c.id);
                                                            }}
                                                            className="text-gray-400 hover:text-red-600"
                                                            title="ì‚­ì œ"
                                                        >
                                                            âœ•
                                                        </button>
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="space-y-2">
                            <a
                                href="mindmap.html"
                                className="w-full px-4 py-3 text-left rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 flex items-center gap-2 transform hover:scale-[1.02] transition-all duration-200 shadow-md"
                            >
                                ğŸ§  ë§ˆì¸ë“œë§µ
                            </a>
                            
                            <a
                                href="feedback.html"
                                className="w-full px-4 py-3 text-left rounded-xl bg-gradient-to-r from-indigo-500 to-blue-500 text-white hover:from-indigo-600 hover:to-blue-600 flex items-center gap-2 transform hover:scale-[1.02] transition-all duration-200 shadow-md"
                            >
                                ğŸ’¬ í”¼ë“œë°± ê²Œì‹œíŒ
                            </a>
                            
                            {/* User Account Section */}
                            {(() => {
                                const user = userManager?.currentUser;
                                const profile = userManager?.userProfile;
                                if (user) {
                                    return (
                                        <div className="border-t border-gray-200 pt-3 mt-3 space-y-2">
                                            <div className="px-3 py-2 bg-gray-50 rounded-xl">
                                                <div className="flex items-center gap-2 mb-2">
                                                    {profile?.avatar_url ? (
                                                        <img src={profile.avatar_url} className="w-8 h-8 rounded-full" />
                                                    ) : (
                                                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold">
                                                            {profile?.full_name?.charAt(0) || user.email?.charAt(0).toUpperCase()}
                                                        </div>
                                                    )}
                                                    <div className="flex-1">
                                                        <div className="text-sm font-medium text-gray-700">
                                                            {profile?.full_name || user.email?.split('@')[0]}
                                                        </div>
                                                        <div className="text-xs text-gray-500">{user.email}</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {userManager.isAdmin && userManager.isAdmin() && (
                                                <a href="admin.html" className="w-full px-4 py-2 text-left rounded-xl hover:bg-gray-100 flex items-center gap-2 text-sm">
                                                    ğŸ› ï¸ ê´€ë¦¬ì íŒ¨ë„
                                                </a>
                                            )}
                                            <a href="dashboard.html" className="w-full px-4 py-2 text-left rounded-xl hover:bg-gray-100 flex items-center gap-2 text-sm">
                                                ğŸ“Š ëŒ€ì‹œë³´ë“œ
                                            </a>
                                            <button
                                                onClick={async () => {
                                                    await userManager.signOut();
                                                    window.location.reload();
                                                }}
                                                className="w-full px-4 py-2 text-left rounded-xl hover:bg-red-50 text-red-600 flex items-center gap-2 text-sm"
                                            >
                                                ğŸšª ë¡œê·¸ì•„ì›ƒ
                                            </button>
                                        </div>
                                    );
                                } else {
                                    return (
                                        <button
                                            onClick={() => {
                                                localStorage.removeItem('skipAuth');
                                                window.location.reload();
                                            }}
                                            className="w-full px-4 py-2 text-left rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 flex items-center gap-2"
                                        >
                                            ğŸ” ë¡œê·¸ì¸
                                        </button>
                                    );
                                }
                            })()}
                            
                            <button
                                onClick={() => setSettingsOpen(true)}
                                className="w-full px-4 py-2 text-left rounded-xl hover:bg-gray-100 flex items-center gap-2"
                            >
                                âš™ï¸ ì„¤ì •
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="main-content p-6">
                        <div className="max-w-5xl mx-auto">
                            {/* Header */}
                            <div className="glassmorphism rounded-3xl p-6 mb-6 fade-in">
                                <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                                            <span className="text-white text-xl">
                                                {selectedCategory?.emoji || "ğŸ“‹"}
                                            </span>
                                        </div>
                                        <div>
                                            <h2 className="text-3xl font-bold text-gray-800">
                                                {selectedCategory?.name || "ì „ì²´"}
                                            </h2>
                                            <p className="text-gray-500">
                                                {filteredTasks.length}ê°œì˜ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤
                                            </p>
                                        </div>
                                    </div>
                                    <div className="flex gap-3 items-center lg:flex-row md:flex-col mobile-header-buttons">
                                        {selectedCategory?.id !== "all" && (
                                            <>
                                                <div className="flex gap-2 items-center w-full md:flex-col lg:flex-row">
                                                    <input
                                                        value={quickTaskText}
                                                        onChange={(e) => setQuickTaskText(e.target.value)}
                                                        onKeyDown={(e) => {
                                                            if (e.key === "Enter" && !e.shiftKey) {
                                                                e.preventDefault();
                                                                addQuickTask();
                                                            }
                                                        }}
                                                        placeholder="ì‘ì—… ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì—”í„°..."
                                                        className="px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-emerald-500 focus:outline-none bg-white/90 backdrop-blur-sm font-medium w-full md:min-w-0 lg:min-w-64 form-input"
                                                    />
                                                    <button
                                                        onClick={addQuickTask}
                                                        disabled={!quickTaskText.trim()}
                                                        className="px-6 py-3 rounded-2xl bg-gradient-to-r from-emerald-500 to-teal-600 text-white hover:from-emerald-600 hover:to-teal-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transform hover:scale-105 transition-all duration-200 shadow-lg font-medium flex items-center justify-center gap-2 btn-primary whitespace-nowrap"
                                                    >
                                                        <span className="text-lg">âœ¨</span>
                                                        ì¶”ê°€
                                                    </button>
                                                </div>
                                                <button
                                                    onClick={() => addTask()}
                                                    className="px-4 py-3 rounded-2xl glassmorphism hover:shadow-md transition-all duration-200 text-gray-700 font-medium btn-secondary whitespace-nowrap"
                                                    title="ë¹ˆ ì‘ì—… ì¶”ê°€"
                                                >
                                                    â• ë¹ˆ ì‘ì—…
                                                </button>
                                            </>
                                        )}
                                        {hasCompletedTasks && (
                                            <button
                                                onClick={clearCompleted}
                                                className="px-4 py-3 rounded-2xl glassmorphism hover:shadow-md transition-all duration-200 text-gray-700 font-medium btn-secondary whitespace-nowrap"
                                            >
                                                ğŸ—‘ï¸ ì™„ë£Œ ì‚­ì œ
                                            </button>
                                        )}
                                    </div>
                                </div>

                                <div className="w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden">
                                    <div
                                        className="bg-gradient-to-r from-emerald-500 to-teal-600 h-4 rounded-full transition-all duration-700 progress-glow relative"
                                        style={{ width: `${stats.progress}%` }}
                                    >
                                        <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
                                    </div>
                                </div>
                            </div>

                            {/* Filters */}
                            <div className="glassmorphism rounded-2xl p-4 mb-6 fade-in">
                                <div className="flex flex-wrap gap-3 md:mobile-filter-grid">
                                    <select
                                        value={statusFilter}
                                        onChange={(e) => setStatusFilter(e.target.value)}
                                        className="px-4 py-3 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white/70 backdrop-blur-sm font-medium form-input"
                                    >
                                        <option value="all">ğŸ“‹ ëª¨ë“  ìƒíƒœ</option>
                                        <option value="pending">â³ ë¯¸ì™„ë£Œ</option>
                                        <option value="completed">âœ… ì™„ë£Œ</option>
                                    </select>
                                    <select
                                        value={prioFilter}
                                        onChange={(e) => setPrioFilter(e.target.value)}
                                        className="px-4 py-3 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white/70 backdrop-blur-sm font-medium form-input"
                                    >
                                        <option value="all">ğŸ¯ ëª¨ë“  ìš°ì„ ìˆœìœ„</option>
                                        {PRIORITIES.map(p => (
                                            <option key={p.value} value={p.value}>
                                                {p.value === 'high' ? 'ğŸ”´' : p.value === 'medium' ? 'ğŸŸ¡' : p.value === 'low' ? 'ğŸ”µ' : 'âšª'} {p.label}
                                            </option>
                                        ))}
                                    </select>
                                    <select
                                        value={sortBy}
                                        onChange={(e) => setSortBy(e.target.value)}
                                        className="px-4 py-3 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white/70 backdrop-blur-sm font-medium form-input"
                                    >
                                        <option value="order">ğŸ“… ë“±ë¡ìˆœ</option>
                                        <option value="created">ğŸ†• ìƒì„±ì¼</option>
                                        <option value="updated">ğŸ“ ìˆ˜ì •ì¼</option>
                                        <option value="priority">â­ ìš°ì„ ìˆœìœ„</option>
                                        <option value="due">â° ë§ˆê°ì¼</option>
                                        <option value="name">ğŸ”¤ ì´ë¦„</option>
                                    </select>
                                </div>
                            </div>

                            {/* Tasks */}
                            <div className="space-y-4">
                                {filteredTasks.length === 0 ? (
                                    <div className="text-center py-12 glassmorphism rounded-2xl fade-in">
                                        <div className="text-6xl mb-4">ğŸ“</div>
                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">
                                            {selectedCategory?.id === "all" 
                                                ? "ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤" 
                                                : "ì´ ì¹´í…Œê³ ë¦¬ì— ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤"}
                                        </h3>
                                        <p className="text-gray-500 mb-4">
                                            {selectedCategory?.id === "all"
                                                ? "ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ìƒˆë¡œìš´ ì‘ì—…ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!"
                                                : "ìƒˆë¡œìš´ ì‘ì—…ì„ ì¶”ê°€í•´ì„œ ì‹œì‘í•´ë³´ì„¸ìš”!"}
                                        </p>
                                        {selectedCategory?.id !== "all" && (
                                            <div className="text-sm text-gray-400">
                                                ğŸ’¡ íŒ: ë”ë¸”í´ë¦­ìœ¼ë¡œ ë¹ ë¥¸ í¸ì§‘, ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    filteredTasks.map((task, index) => (
                                        <TaskCard
                                            key={task.id}
                                            task={task}
                                            categories={categories}
                                            index={index}
                                            filteredTasks={filteredTasks}
                                            onUpdate={updateTask}
                                            onDelete={deleteTask}
                                            onToggle={toggleTask}
                                            onTogglePin={togglePinTask}
                                            onReorder={reorderTasks}
                                        />
                                    ))
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Settings Modal */}
                    {settingsOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-md m-4 glassmorphism">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-bold">âš™ï¸ ì„¤ì •</h3>
                                    <button
                                        onClick={() => setSettingsOpen(false)}
                                        className="text-gray-400 hover:text-gray-600 p-2 rounded-xl hover:bg-gray-100"
                                    >
                                        âœ•
                                    </button>
                                </div>

                                <div className="space-y-6">
                                    <section>
                                        <h4 className="font-semibold mb-2">ğŸ”Š ì‚¬ìš´ë“œ</h4>
                                        <div className="flex items-center gap-3">
                                            <label className="inline-flex items-center gap-2 text-sm">
                                                <input
                                                    type="checkbox"
                                                    checked={soundOn}
                                                    onChange={(e) => setSoundOn(e.target.checked)}
                                                    className="rounded"
                                                />
                                                ì²´í¬/í•´ì œ ì‹œ íš¨ê³¼ìŒ ì¬ìƒ
                                            </label>
                                            <button
                                                onClick={() => {
                                                    if (soundOn) playSuccess();
                                                }}
                                                className="px-3 py-2 rounded-xl border hover:bg-gray-50 text-sm btn-secondary"
                                            >
                                                ğŸµ í…ŒìŠ¤íŠ¸
                                            </button>
                                        </div>
                                    </section>

                                    <section>
                                        <h4 className="font-semibold mb-2">ğŸ”¤ ê¸€ê¼´ í¬ê¸°</h4>
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between">
                                                <span className="text-sm text-gray-600">í˜„ì¬ í¬ê¸°: {fontSize}px</span>
                                                <button
                                                    onClick={resetFontSize}
                                                    className="px-2 py-1 text-xs rounded border hover:bg-gray-50 btn-secondary"
                                                >
                                                    ì´ˆê¸°í™”
                                                </button>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button
                                                    onClick={decreaseFontSize}
                                                    disabled={fontSize <= 12}
                                                    className="w-10 h-10 rounded-xl border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed btn-secondary flex items-center justify-center font-bold text-lg"
                                                >
                                                    -
                                                </button>
                                                <div className="flex-1 mx-3">
                                                    <div className="h-2 bg-gray-200 rounded-full">
                                                        <div 
                                                            className="h-2 bg-blue-500 rounded-full transition-all duration-300"
                                                            style={{ width: `${((fontSize - 12) / (24 - 12)) * 100}%` }}
                                                        ></div>
                                                    </div>
                                                    <div className="flex justify-between text-xs text-gray-400 mt-1">
                                                        <span>12px</span>
                                                        <span>24px</span>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={increaseFontSize}
                                                    disabled={fontSize >= 24}
                                                    className="w-10 h-10 rounded-xl border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed btn-secondary flex items-center justify-center font-bold text-lg"
                                                >
                                                    +
                                                </button>
                                            </div>
                                            <p className="text-xs text-gray-500">
                                                ê¸€ê¼´ í¬ê¸°ëŠ” ìë™ìœ¼ë¡œ ì €ì¥ë˜ë©°, ë‹¤ìŒì— ì ‘ì†í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
                                            </p>
                                        </div>
                                    </section>

                                    <section>
                                        <h4 className="font-semibold mb-2">ğŸ’¾ ë°ì´í„° ë°±ì—…</h4>
                                        <div className="space-y-2">
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={exportData}
                                                    className="flex-1 px-4 py-2 rounded-xl border hover:bg-gray-50 btn-secondary"
                                                >
                                                    ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°
                                                </button>
                                                <button
                                                    onClick={importData}
                                                    className="flex-1 px-4 py-2 rounded-xl border hover:bg-gray-50 btn-secondary"
                                                >
                                                    ğŸ“¥ JSON ê°€ì ¸ì˜¤ê¸°
                                                </button>
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={exportToText}
                                                    className="flex-1 px-4 py-2 rounded-xl border hover:bg-gray-50 btn-secondary"
                                                >
                                                    ğŸ“ í…ìŠ¤íŠ¸ ì¶”ì¶œ
                                                </button>
                                                <button
                                                    onClick={importTextFile}
                                                    className="flex-1 px-4 py-2 rounded-xl border hover:bg-gray-50 btn-secondary"
                                                >
                                                    ğŸ“„ í…ìŠ¤íŠ¸ ì—…ë¡œë“œ
                                                </button>
                                            </div>
                                        </div>
                                        <p className="text-xs text-gray-500 mt-2">
                                            JSON: ì™„ì „í•œ ë°±ì—…/ë³µì› | í…ìŠ¤íŠ¸: ë©”ëª¨ì¥ ì •ë¦¬ìš© ì¶”ì¶œ/ì—…ë¡œë“œ
                                        </p>
                                    </section>

                                    <section>
                                        <h4 className="font-semibold mb-2">ğŸ¯ ë“œë˜ê·¸ ì•¤ ë“œë¡­</h4>
                                        <p className="text-sm text-gray-600">
                                            ì‘ì—… ì¹´ë“œ ì™¼ìª½ì˜ <span className="font-mono text-gray-800">â‹®â‹®</span> í•¸ë“¤ì„ ë“œë˜ê·¸í•´ì„œ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </section>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Hidden File Inputs */}
                    <input
                        ref={fileInputRef}
                        type="file"
                        accept=".json"
                        onChange={handleFileImport}
                        style={{ display: 'none' }}
                    />
                    <input
                        ref={textFileInputRef}
                        type="file"
                        accept=".txt,.text"
                        onChange={handleTextFileImport}
                        style={{ display: 'none' }}
                    />
                </div>
            );
        }

        // Render the application using React 18 API
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
<!-- Updated: 2025ë…„ 08ì›” 27ì¼ ìˆ˜ ì˜¤ì „  1:53:16 -->
